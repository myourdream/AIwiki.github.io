



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="AI Wiki 是一个编程竞赛知识整合站点，提供有趣又实用的编程竞赛知识以及其他有帮助的内容，帮助广大编程竞赛爱好者更快更深入地学习编程竞赛">
      
      
        <link rel="canonical" href="https://hai5g.cn/aiwiki/qa500/ch17_模型压缩、加速及移动端部署/17.8.1 NCNN部署/">
      
      
        <meta name="author" content="AI Wiki Team">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.2.0">
    
    
      
        <title>17.8.1 NCNN部署 - AI Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.750b69bd.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,400,400i,700|Fira+Mono">
        <style>body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../../../manifest.webmanifest">
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ah@1.5.0/han.min.css">
    
      <link rel="stylesheet" href="../../../_static/css/extra.css?v=11">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#1781-ncnn" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://hai5g.cn/aiwiki" title="AI Wiki" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              AI Wiki
            </span>
            <span class="md-header-nav__topic">
              17.8.1 NCNN部署
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/myourdream/aiwiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aiwiki
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../.." title="简介" class="md-tabs__link">
          简介
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../basic/" title="特征工程" class="md-tabs__link">
          特征工程
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../" title="深度学习500问" class="md-tabs__link">
          深度学习500问
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../dp/" title="经典算法" class="md-tabs__link">
          经典算法
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../string/" title="集成学习算法" class="md-tabs__link">
          集成学习算法
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../math/" title="CNN" class="md-tabs__link">
          CNN
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../ds/" title="RNN" class="md-tabs__link">
          RNN
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../graph/" title="GAN" class="md-tabs__link">
          GAN
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../geometry/" title="计算机视觉" class="md-tabs__link">
          计算机视觉
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../misc/" title="NLP" class="md-tabs__link">
          NLP
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../misc/" title="推荐系统" class="md-tabs__link">
          推荐系统
        </a>
      
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://hai5g.cn/aiwiki" title="AI Wiki" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    AI Wiki
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/myourdream/aiwiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aiwiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      简介
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        简介
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/mode/" title="AI 赛事与赛制" class="md-nav__link">
      AI 赛事与赛制
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/icpc/" title="ICPC/CCPC 赛事与赛制" class="md-nav__link">
      ICPC/CCPC 赛事与赛制
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/resources/" title="学习资源" class="md-nav__link">
      学习资源
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/common-mistakes/" title="常见错误" class="md-nav__link">
      常见错误
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/common-tricks/" title="常见技巧" class="md-nav__link">
      常见技巧
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/non-traditional/" title="非传统题" class="md-nav__link">
      非传统题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-8" type="checkbox" id="nav-1-8">
    
    <label class="md-nav__link" for="nav-1-8">
      工具软件
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-8">
        工具软件
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/judgers/" title="评测工具" class="md-nav__link">
      评测工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/editors/" title="编辑工具" class="md-nav__link">
      编辑工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/wsl/" title="WSL (Windows 10)" class="md-nav__link">
      WSL (Windows 10)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/spj/" title="Special Judge" class="md-nav__link">
      Special Judge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-8-5" type="checkbox" id="nav-1-8-5">
    
    <label class="md-nav__link" for="nav-1-8-5">
      Testlib
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-8-5">
        Testlib
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/testlib/" title="Testlib 简介" class="md-nav__link">
      Testlib 简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/testlib/general/" title="通用" class="md-nav__link">
      通用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/testlib/generator/" title="Generator" class="md-nav__link">
      Generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/testlib/validator/" title="Validator" class="md-nav__link">
      Validator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/testlib/interactor/" title="Interactor" class="md-nav__link">
      Interactor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/testlib/checker/" title="Checker" class="md-nav__link">
      Checker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/docker-deploy/" title="Docker 部署" class="md-nav__link">
      Docker 部署
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/about/" title="关于本项目" class="md-nav__link">
      关于本项目
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../intro/faq/" title="F.A.Q." class="md-nav__link">
      F.A.Q.
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      特征工程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        特征工程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/" title="基础部分简介" class="md-nav__link">
      基础部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/enumerate/" title="枚举" class="md-nav__link">
      枚举
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/simulate/" title="模拟" class="md-nav__link">
      模拟
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/divide-and-conquer/" title="递归 & 分治" class="md-nav__link">
      递归 & 分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/greedy/" title="贪心" class="md-nav__link">
      贪心
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      排序
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        排序
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/sort-intro/" title="排序简介" class="md-nav__link">
      排序简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/selection-sort/" title="选择排序" class="md-nav__link">
      选择排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/bubble-sort/" title="冒泡排序" class="md-nav__link">
      冒泡排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/insertion-sort/" title="插入排序" class="md-nav__link">
      插入排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/bucket-sort/" title="计数排序" class="md-nav__link">
      计数排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/quick-sort/" title="快速排序" class="md-nav__link">
      快速排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/merge-sort/" title="归并排序" class="md-nav__link">
      归并排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/heap-sort/" title="堆排序" class="md-nav__link">
      堆排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/radix-sort/" title="基数排序" class="md-nav__link">
      基数排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/shell-sort/" title="希尔排序" class="md-nav__link">
      希尔排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/stl-sort/" title="排序相关 STL" class="md-nav__link">
      排序相关 STL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/use-of-sort/" title="排序应用" class="md-nav__link">
      排序应用
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/expression/" title="表达式求值" class="md-nav__link">
      表达式求值
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/binary/" title="二分" class="md-nav__link">
      二分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/construction/" title="构造" class="md-nav__link">
      构造
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/prefix-sum/" title="前缀和 & 差分" class="md-nav__link">
      前缀和 & 差分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/file-operation/" title="文件操作" class="md-nav__link">
      文件操作
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      深度学习500问
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        深度学习500问
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../content/" title="目录" class="md-nav__link">
      目录
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch01_math/ch01_math/" title="第一章_数学基础" class="md-nav__link">
      第一章_数学基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch02_机器学习基础/第二章_机器学习基础/" title="第二章_机器学习基础" class="md-nav__link">
      第二章_机器学习基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch03_深度学习基础/第三章_深度学习基础/" title="第三章_深度学习基础" class="md-nav__link">
      第三章_深度学习基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch04_经典网络/第四章_经典网络/" title="第四章_经典网络" class="md-nav__link">
      第四章_经典网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch05_卷积神经网络(CNN)/第五章 卷积神经网络（CNN）/" title="第五章 卷积神经网络（CNN）" class="md-nav__link">
      第五章 卷积神经网络（CNN）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch06_循环神经网络(RNN)/第六章_循环神经网络(RNN)/" title="第六章_循环神经网络(RNN)" class="md-nav__link">
      第六章_循环神经网络(RNN)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch07_生成对抗网络(GAN)/ch7/" title="第七章_生成对抗网络(GAN)" class="md-nav__link">
      第七章_生成对抗网络(GAN)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch08_目标检测/第八章_目标检测/" title="第八章_目标检测" class="md-nav__link">
      第八章_目标检测
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch09_图像分割/第九章_图像分割/" title="第九章_图像分割" class="md-nav__link">
      第九章_图像分割
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch10_强化学习/第十章_强化学习/" title="第十章_强化学习" class="md-nav__link">
      第十章_强化学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch11_迁移学习/第十一章_迁移学习/" title="第十一章_迁移学习" class="md-nav__link">
      第十一章_迁移学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch12_网络搭建及训练/第十二章_网络搭建及训练/" title="第十二章_网络搭建及训练" class="md-nav__link">
      第十二章_网络搭建及训练
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch13_优化算法/第十三章_优化算法/" title="第十三章_优化算法" class="md-nav__link">
      第十三章_优化算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch14_超参数调整/第十四章_超参数调整/" title="第十四章_超参数调整" class="md-nav__link">
      第十四章_超参数调整
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch15_GPU和框架选型/第十五章_异构运算、GPU及框架选型/" title="第十五章_异构运算、GPU及框架选型" class="md-nav__link">
      第十五章_异构运算、GPU及框架选型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch16_自然语言处理(NLP)/第十六章_NLP/" title="第十六章_NLP" class="md-nav__link">
      第十六章_NLP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../第十七章_模型压缩、加速及移动端部署/" title="第十七章_模型压缩、加速及移动端部署" class="md-nav__link">
      第十七章_模型压缩、加速及移动端部署
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch18_后端架构选型、离线及实时计算/第十八章_后端架构选型、离线及实时计算/" title="第十八章_后端架构选型、离线及实时计算" class="md-nav__link">
      第十八章_后端架构选型、离线及实时计算
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ch18_后端架构选型及应用场景/第十八章_后端架构选型及应用场景/" title="第十八章_后端架构选型及应用场景" class="md-nav__link">
      第十八章_后端架构选型及应用场景
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      经典算法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        经典算法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/" title="动态规划部分简介" class="md-nav__link">
      动态规划部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/memo/" title="记忆化搜索" class="md-nav__link">
      记忆化搜索
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/knapsack/" title="背包 DP" class="md-nav__link">
      背包 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/interval/" title="区间 DP" class="md-nav__link">
      区间 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/dag/" title="DAG 上的 DP" class="md-nav__link">
      DAG 上的 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/tree/" title="树形 DP" class="md-nav__link">
      树形 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/state/" title="状压 DP" class="md-nav__link">
      状压 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/number/" title="数位 DP" class="md-nav__link">
      数位 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/plug/" title="插头 DP" class="md-nav__link">
      插头 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-10" type="checkbox" id="nav-4-10">
    
    <label class="md-nav__link" for="nav-4-10">
      DP 优化
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-10">
        DP 优化
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/optimizations/binary-knapsack/" title="二进制分组解多重背包" class="md-nav__link">
      二进制分组解多重背包
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/optimizations/monotonous-queue-stack/" title="单调队列/单调栈优化" class="md-nav__link">
      单调队列/单调栈优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/optimizations/convex-hull-optimization/" title="斜率优化" class="md-nav__link">
      斜率优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/optimizations/knuth-yao-quadrangle-inequality/" title="四边形不等式优化" class="md-nav__link">
      四边形不等式优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/optimizations/state-optimization/" title="状态设计优化" class="md-nav__link">
      状态设计优化
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../dp/misc/" title="其它 DP 方法" class="md-nav__link">
      其它 DP 方法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      集成学习算法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        集成学习算法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/" title="字符串部分简介" class="md-nav__link">
      字符串部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/lib-func/" title="标准库" class="md-nav__link">
      标准库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/match/" title="字符串匹配" class="md-nav__link">
      字符串匹配
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/hash/" title="哈希" class="md-nav__link">
      哈希
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/prefix-function/" title="前缀函数与 KMP 算法" class="md-nav__link">
      前缀函数与 KMP 算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/trie/" title="字典树 (Trie)" class="md-nav__link">
      字典树 (Trie)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/pam/" title="回文自动机" class="md-nav__link">
      回文自动机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/sa/" title="后缀数组 (SA)" class="md-nav__link">
      后缀数组 (SA)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/ac-automaton/" title="AC 自动机" class="md-nav__link">
      AC 自动机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/sam/" title="后缀自动机 (SAM)" class="md-nav__link">
      后缀自动机 (SAM)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/suffix-tree/" title="后缀树" class="md-nav__link">
      后缀树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/manacher/" title="Manacher" class="md-nav__link">
      Manacher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/minimal-string/" title="最小表示法" class="md-nav__link">
      最小表示法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../string/z-function/" title="Z 函数（扩展 KMP）" class="md-nav__link">
      Z 函数（扩展 KMP）
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      CNN
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        CNN
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/" title="数学部分简介" class="md-nav__link">
      数学部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/base/" title="进制" class="md-nav__link">
      进制
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/bit/" title="位运算" class="md-nav__link">
      位运算
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/bignum/" title="高精度" class="md-nav__link">
      高精度
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/quick-pow/" title="快速幂" class="md-nav__link">
      快速幂
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6" type="checkbox" id="nav-6-6">
    
    <label class="md-nav__link" for="nav-6-6">
      整除及其性质
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-6">
        整除及其性质
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/prime/" title="素数" class="md-nav__link">
      素数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/gcd/" title="最大公约数" class="md-nav__link">
      最大公约数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/euler/" title="欧拉函数" class="md-nav__link">
      欧拉函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/sieve/" title="筛法" class="md-nav__link">
      筛法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/fermat/" title="费马小定理" class="md-nav__link">
      费马小定理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7" type="checkbox" id="nav-6-7">
    
    <label class="md-nav__link" for="nav-6-7">
      同余方程相关
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-7">
        同余方程相关
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/bezouts/" title="裴蜀定理" class="md-nav__link">
      裴蜀定理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/inverse/" title="乘法逆元" class="md-nav__link">
      乘法逆元
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/linear-equation/" title="线性同余方程" class="md-nav__link">
      线性同余方程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/crt/" title="中国剩余定理" class="md-nav__link">
      中国剩余定理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/bsgs/" title="BSGS" class="md-nav__link">
      BSGS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/primitive-root/" title="原根" class="md-nav__link">
      原根
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-8" type="checkbox" id="nav-6-8">
    
    <label class="md-nav__link" for="nav-6-8">
      线性代数
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-8">
        线性代数
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/matrix/" title="矩阵" class="md-nav__link">
      矩阵
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/gauss/" title="高斯消元" class="md-nav__link">
      高斯消元
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/basis/" title="线性基" class="md-nav__link">
      线性基
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/complex/" title="复数" class="md-nav__link">
      复数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/dictionary/" title="分段打表" class="md-nav__link">
      分段打表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-11" type="checkbox" id="nav-6-11">
    
    <label class="md-nav__link" for="nav-6-11">
      数论函数相关
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-11">
        数论函数相关
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/mobius/" title="莫比乌斯反演" class="md-nav__link">
      莫比乌斯反演
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/du-sieves/" title="杜教筛" class="md-nav__link">
      杜教筛
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-12" type="checkbox" id="nav-6-12">
    
    <label class="md-nav__link" for="nav-6-12">
      多项式
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-12">
        多项式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/intro/" title="多项式部分简介" class="md-nav__link">
      多项式部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/lagrange-poly/" title="拉格朗日插值" class="md-nav__link">
      拉格朗日插值
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/fft/" title="快速傅里叶变换" class="md-nav__link">
      快速傅里叶变换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/ntt/" title="快速数论变换" class="md-nav__link">
      快速数论变换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/fwt/" title="快速沃尔什变换" class="md-nav__link">
      快速沃尔什变换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/inv/" title="多项式求逆" class="md-nav__link">
      多项式求逆
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/sqrt/" title="多项式开方" class="md-nav__link">
      多项式开方
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/div-mod/" title="多项式除法|取模" class="md-nav__link">
      多项式除法|取模
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/ln-exp/" title="多项式对数函数|指数函数" class="md-nav__link">
      多项式对数函数|指数函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/newton/" title="多项式牛顿迭代" class="md-nav__link">
      多项式牛顿迭代
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/multipoint-eval-interpolation/" title="多项式多点求值|快速插值" class="md-nav__link">
      多项式多点求值|快速插值
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/tri-func/" title="多项式三角函数" class="md-nav__link">
      多项式三角函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/poly/inv-tri-func/" title="多项式反三角函数" class="md-nav__link">
      多项式反三角函数
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-13" type="checkbox" id="nav-6-13">
    
    <label class="md-nav__link" for="nav-6-13">
      组合数学
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-13">
        组合数学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/combination/" title="排列组合" class="md-nav__link">
      排列组合
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/catalan/" title="卡特兰数" class="md-nav__link">
      卡特兰数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/stirling/" title="斯特林数" class="md-nav__link">
      斯特林数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/cantor/" title="康托展开" class="md-nav__link">
      康托展开
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/inclusion-exclusion-principle/" title="容斥原理" class="md-nav__link">
      容斥原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/drawer-principle/" title="抽屉原理" class="md-nav__link">
      抽屉原理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/expectation/" title="概率 & 期望" class="md-nav__link">
      概率 & 期望
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/permutation-group/" title="置换群" class="md-nav__link">
      置换群
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/integral/" title="数值积分" class="md-nav__link">
      数值积分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/linear-programming/" title="线性规划" class="md-nav__link">
      线性规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/game-theory/" title="博弈论" class="md-nav__link">
      博弈论
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../math/misc/" title="杂项" class="md-nav__link">
      杂项
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      RNN
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        RNN
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/" title="数据结构部分简介" class="md-nav__link">
      数据结构部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      STL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        STL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/stl/" title="STL 简介" class="md-nav__link">
      STL 简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/stl/vector/" title="vector" class="md-nav__link">
      vector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/stl/priority_queue/" title="priority_queue" class="md-nav__link">
      priority_queue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/stl/map/" title="map" class="md-nav__link">
      map
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/stl/bitset/" title="bitset" class="md-nav__link">
      bitset
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      pb_ds
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        pb_ds
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/pb-ds/" title="pb_ds 简介" class="md-nav__link">
      pb_ds 简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/pb-ds/priority-queue/" title="__gnu_pbds::priority_queue" class="md-nav__link">
      __gnu_pbds::priority_queue
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/stack/" title="栈" class="md-nav__link">
      栈
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/queue/" title="队列" class="md-nav__link">
      队列
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/linked-list/" title="链表" class="md-nav__link">
      链表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/hash/" title="哈希表" class="md-nav__link">
      哈希表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/dsu/" title="并查集" class="md-nav__link">
      并查集
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-9" type="checkbox" id="nav-7-9">
    
    <label class="md-nav__link" for="nav-7-9">
      堆
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-9">
        堆
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/heap/" title="堆简介" class="md-nav__link">
      堆简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/binary-heap/" title="二叉堆" class="md-nav__link">
      二叉堆
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/pairing-heap/" title="配对堆" class="md-nav__link">
      配对堆
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-10" type="checkbox" id="nav-7-10">
    
    <label class="md-nav__link" for="nav-7-10">
      块状数据结构
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-10">
        块状数据结构
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/square-root-decomposition/" title="分块思想" class="md-nav__link">
      分块思想
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/block-list/" title="块状链表" class="md-nav__link">
      块状链表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/block-array/" title="块状数组" class="md-nav__link">
      块状数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/tree-decompose/" title="树分块" class="md-nav__link">
      树分块
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/monotonous-stack/" title="单调栈" class="md-nav__link">
      单调栈
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/monotonous-queue/" title="单调队列" class="md-nav__link">
      单调队列
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/sparse-table/" title="倍增" class="md-nav__link">
      倍增
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/bit/" title="树状数组" class="md-nav__link">
      树状数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/segment/" title="线段树" class="md-nav__link">
      线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/dividing/" title="划分树" class="md-nav__link">
      划分树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-17" type="checkbox" id="nav-7-17">
    
    <label class="md-nav__link" for="nav-7-17">
      平衡树
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-17">
        平衡树
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/bst/" title="二叉搜索树简介" class="md-nav__link">
      二叉搜索树简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/treap/" title="Treap" class="md-nav__link">
      Treap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/splay/" title="Splay" class="md-nav__link">
      Splay
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/wblt/" title="WBLT" class="md-nav__link">
      WBLT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/sbt/" title="Size Balanced Tree" class="md-nav__link">
      Size Balanced Tree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/avl/" title="AVL 树" class="md-nav__link">
      AVL 树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/scapegoat/" title="替罪羊树" class="md-nav__link">
      替罪羊树
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-18" type="checkbox" id="nav-7-18">
    
    <label class="md-nav__link" for="nav-7-18">
      树套树
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-18">
        树套树
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/seg-in-seg/" title="线段树套线段树" class="md-nav__link">
      线段树套线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/seg-in-balanced/" title="平衡树套线段树" class="md-nav__link">
      平衡树套线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/balanced-in-seg/" title="线段树套平衡树" class="md-nav__link">
      线段树套平衡树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/persistent-in-bit/" title="树状数组套主席树" class="md-nav__link">
      树状数组套主席树
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/k-dtree/" title="K-Dtree" class="md-nav__link">
      K-Dtree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-20" type="checkbox" id="nav-7-20">
    
    <label class="md-nav__link" for="nav-7-20">
      可持久化数据结构
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-20">
        可持久化数据结构
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/persistent/" title="可持久化数据结构简介" class="md-nav__link">
      可持久化数据结构简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/persistent-seg/" title="可持久化线段树" class="md-nav__link">
      可持久化线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/persistent-block-array/" title="可持久化块状数组" class="md-nav__link">
      可持久化块状数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/persistent-balanced/" title="可持久化平衡树" class="md-nav__link">
      可持久化平衡树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/persistent-trie/" title="可持久化字典树" class="md-nav__link">
      可持久化字典树
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/odt/" title="珂朵莉树" class="md-nav__link">
      珂朵莉树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/lct/" title="Link Cut Tree" class="md-nav__link">
      Link Cut Tree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ds/ett/" title="Euler Tour Tree" class="md-nav__link">
      Euler Tour Tree
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      GAN
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        GAN
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/" title="图论部分简介" class="md-nav__link">
      图论部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/basic/" title="图论基础" class="md-nav__link">
      图论基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/traverse/" title="图的遍历" class="md-nav__link">
      图的遍历
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-4" type="checkbox" id="nav-8-4">
    
    <label class="md-nav__link" for="nav-8-4">
      树上问题
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-4">
        树上问题
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/tree-basic/" title="树基础" class="md-nav__link">
      树基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/lca/" title="最近公共祖先" class="md-nav__link">
      最近公共祖先
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/dfs-order/" title="DFS 序" class="md-nav__link">
      DFS 序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/tree-misc/" title="树的其他问题" class="md-nav__link">
      树的其他问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/tree-hash/" title="树哈希" class="md-nav__link">
      树哈希
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/heavy-light-decomposition/" title="树链剖分" class="md-nav__link">
      树链剖分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/tree-divide/" title="树分治" class="md-nav__link">
      树分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/dynamic-tree-divide/" title="动态树分治" class="md-nav__link">
      动态树分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/virtual-tree/" title="虚树" class="md-nav__link">
      虚树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/dsu-on-tree/" title="树上启发式合并" class="md-nav__link">
      树上启发式合并
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/matrix-tree/" title="矩阵树定理" class="md-nav__link">
      矩阵树定理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/dag/" title="有向无环图" class="md-nav__link">
      有向无环图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/topo/" title="拓扑排序" class="md-nav__link">
      拓扑排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/mst/" title="最小生成树" class="md-nav__link">
      最小生成树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/mdst/" title="最小树形图" class="md-nav__link">
      最小树形图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/shortest-path/" title="最短路" class="md-nav__link">
      最短路
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/differential-constraints/" title="差分约束" class="md-nav__link">
      差分约束
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/kth-path/" title="k 短路" class="md-nav__link">
      k 短路
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-13" type="checkbox" id="nav-8-13">
    
    <label class="md-nav__link" for="nav-8-13">
      连通性相关
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-13">
        连通性相关
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/scc/" title="强连通分量" class="md-nav__link">
      强连通分量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/bcc/" title="双连通分量" class="md-nav__link">
      双连通分量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/bridge/" title="割点和桥" class="md-nav__link">
      割点和桥
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/2-sat/" title="2-SAT" class="md-nav__link">
      2-SAT
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/euler/" title="欧拉图" class="md-nav__link">
      欧拉图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/hamilton/" title="哈密顿图" class="md-nav__link">
      哈密顿图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/bi-graph/" title="二分图" class="md-nav__link">
      二分图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/min-circle/" title="最小环" class="md-nav__link">
      最小环
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/planar/" title="平面图" class="md-nav__link">
      平面图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/color/" title="图的着色" class="md-nav__link">
      图的着色
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-20" type="checkbox" id="nav-8-20">
    
    <label class="md-nav__link" for="nav-8-20">
      网络流
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-20">
        网络流
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/flow/" title="网络流简介" class="md-nav__link">
      网络流简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/flow/node/" title="拆点" class="md-nav__link">
      拆点
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/flow/max-flow/" title="最大流" class="md-nav__link">
      最大流
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/flow/min-cut/" title="最小割" class="md-nav__link">
      最小割
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/flow/min-cost/" title="费用流" class="md-nav__link">
      费用流
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/flow/bound/" title="上下界网络流" class="md-nav__link">
      上下界网络流
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../graph/misc/" title="图论杂项" class="md-nav__link">
      图论杂项
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      计算机视觉
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        计算机视觉
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/" title="计算几何部分简介" class="md-nav__link">
      计算几何部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/2d/" title="二维计算几何基础" class="md-nav__link">
      二维计算几何基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/3d/" title="三维计算几何基础" class="md-nav__link">
      三维计算几何基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/distance/" title="距离" class="md-nav__link">
      距离
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/pick/" title="Pick 定理" class="md-nav__link">
      Pick 定理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/triangulation/" title="三角剖分" class="md-nav__link">
      三角剖分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/convex-hull/" title="凸包" class="md-nav__link">
      凸包
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/scanning/" title="扫描线" class="md-nav__link">
      扫描线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/rotating-calipers/" title="旋转卡壳" class="md-nav__link">
      旋转卡壳
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/half-plane-intersection/" title="半平面交" class="md-nav__link">
      半平面交
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/nearest-points/" title="平面最近点对" class="md-nav__link">
      平面最近点对
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../geometry/magic/" title="计算几何杂项" class="md-nav__link">
      计算几何杂项
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      NLP
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        NLP
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/" title="杂项简介" class="md-nav__link">
      杂项简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/io/" title="读入、输出优化" class="md-nav__link">
      读入、输出优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/complexity/" title="复杂度" class="md-nav__link">
      复杂度
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/discrete/" title="离散化" class="md-nav__link">
      离散化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-5" type="checkbox" id="nav-10-5">
    
    <label class="md-nav__link" for="nav-10-5">
      离线算法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-5">
        离线算法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/offline/" title="离线算法简介" class="md-nav__link">
      离线算法简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/cdq-divide/" title="CDQ 分治" class="md-nav__link">
      CDQ 分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/mo-algo/" title="莫队算法" class="md-nav__link">
      莫队算法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/fractional-programming/" title="分数规划" class="md-nav__link">
      分数规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-7" type="checkbox" id="nav-10-7">
    
    <label class="md-nav__link" for="nav-10-7">
      随机化
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-7">
        随机化
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/random/" title="随机函数" class="md-nav__link">
      随机函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/hill-climbing/" title="爬山算法" class="md-nav__link">
      爬山算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/simulated-annealing/" title="模拟退火" class="md-nav__link">
      模拟退火
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/random-incremental/" title="随机增量法" class="md-nav__link">
      随机增量法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/largest-matrix/" title="悬线法" class="md-nav__link">
      悬线法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/cc-basic/" title="计算理论基础" class="md-nav__link">
      计算理论基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/endianness/" title="字节顺序" class="md-nav__link">
      字节顺序
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      推荐系统
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        推荐系统
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/" title="杂项简介" class="md-nav__link">
      杂项简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/io/" title="读入、输出优化" class="md-nav__link">
      读入、输出优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/complexity/" title="复杂度" class="md-nav__link">
      复杂度
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/discrete/" title="离散化" class="md-nav__link">
      离散化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11-5" type="checkbox" id="nav-11-5">
    
    <label class="md-nav__link" for="nav-11-5">
      离线算法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-11-5">
        离线算法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/offline/" title="离线算法简介" class="md-nav__link">
      离线算法简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/cdq-divide/" title="CDQ 分治" class="md-nav__link">
      CDQ 分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/mo-algo/" title="莫队算法" class="md-nav__link">
      莫队算法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/fractional-programming/" title="分数规划" class="md-nav__link">
      分数规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11-7" type="checkbox" id="nav-11-7">
    
    <label class="md-nav__link" for="nav-11-7">
      随机化
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-11-7">
        随机化
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/random/" title="随机函数" class="md-nav__link">
      随机函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/hill-climbing/" title="爬山算法" class="md-nav__link">
      爬山算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/simulated-annealing/" title="模拟退火" class="md-nav__link">
      模拟退火
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/random-incremental/" title="随机增量法" class="md-nav__link">
      随机增量法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/largest-matrix/" title="悬线法" class="md-nav__link">
      悬线法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/cc-basic/" title="计算理论基础" class="md-nav__link">
      计算理论基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/endianness/" title="字节顺序" class="md-nav__link">
      字节顺序
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../about/" title="关于" class="md-nav__link">
      关于
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1781-ncnn" title="17.8.1 NCNN部署" class="md-nav__link">
    17.8.1 NCNN部署
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1ncnnalexnet" title="1.在电脑端使用ncnn实现分类(alexnet)" class="md-nav__link">
    1.在电脑端使用ncnn实现分类(alexnet)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-win-x64-visual-studio-community-2017" title="2. Win x64 (Visual Studio Community 2017)" class="md-nav__link">
    2. Win x64 (Visual Studio Community 2017)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-androidncnn" title="3. Android端使用ncnn" class="md-nav__link">
    3. Android端使用ncnn
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="评论" class="md-nav__link md-nav__link--active">
            评论
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/myourdream/aiwiki/blob/master/docs/qa500/ch17_模型压缩、加速及移动端部署/17.8.1 NCNN部署.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>17.8.1 NCNN部署</h1>
                
                <h3 id="1781-ncnn">17.8.1 NCNN部署<a class="headerlink" href="#1781-ncnn" title="Permanent link">&para;</a></h3>
<h5 id="1ncnnalexnet">1.在电脑端使用ncnn实现分类(alexnet)<a class="headerlink" href="#1ncnnalexnet" title="Permanent link">&para;</a></h5>
<p>s1，安装g++，cmake，protobuf，opencv</p>
<p>s2，对源码进行编译</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>git clone https://github.com/Tencent/ncnn
$ <span class="nb">cd</span> &lt;ncnn-root-dir&gt;
$ mkdir -p build
$ <span class="nb">cd</span> build
$ cmake ..
$ make -j4
</pre></div>
</td></tr></table>

<p>s3，准备caffe模型文件(alexnet)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>deploy.prototxt  
snapshot_10000.caffemodel  
</pre></div>
</td></tr></table>

<p>alexnet   <a href="https://github.com/BVLC/caffe/tree/master/models/bvlc_alexnet">deploy.prototxt</a>， <a href="http://dl.caffe.berkeleyvision.org/bvlc_alexnet.caffemodel">caffemodel</a></p>
<p>s4，使用ncnn转换工具将旧caffe版本的prototxt和caffemodel转新版本</p>
<p>将旧caffe版本的prototxt和caffemodel存放在caffe/build/tools目录下，执行如下命令完成转换</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./upgrade_net_proto_text <span class="o">[</span>old prototxt<span class="o">]</span> <span class="o">[</span>new prototxt<span class="o">]</span>
./upgrade_net_proto_binary <span class="o">[</span>old caffemodel<span class="o">]</span> <span class="o">[</span>new caffemodel<span class="o">]</span>
</pre></div>
</td></tr></table>

<p>s5，将deploy.prototxt中输入层替换成input层(如果只读取一张图片将dim设置为1)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">layer</span> <span class="p">{</span>
  <span class="n">name</span><span class="o">:</span> <span class="s">&quot;data&quot;</span>
  <span class="n">type</span><span class="o">:</span> <span class="s">&quot;Input&quot;</span>
  <span class="n">top</span><span class="o">:</span> <span class="s">&quot;data&quot;</span>
  <span class="n">input_param</span> <span class="p">{</span> <span class="n">shape</span><span class="o">:</span> <span class="p">{</span> <span class="n">dim</span><span class="o">:</span> <span class="mi">1</span> <span class="n">dim</span><span class="o">:</span> <span class="mi">3</span> <span class="n">dim</span><span class="o">:</span> <span class="mi">227</span> <span class="n">dim</span><span class="o">:</span> <span class="mi">227</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>s6，使用caffe2ncnn工具将caffe model转成ncnn model</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./caffe2ncnn deploy.prototxt bvlc_alexnet.caffemodel alexnet.param alexnet.bin
</pre></div>
</td></tr></table>

<p>在ncnn/build/tools目录下生成param和bin文件。</p>
<p>s7，对模型参数进行加密</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./ncnn2mem alexnet.param alexnet.bin alexnet.id.h alexnet.mem.h
</pre></div>
</td></tr></table>

<p>在ncnn/build/tools目录下生成.param、.bin和.h文件。</p>
<p>alexnet.param    网络的模型参数</p>
<p>alexnet.bin   网络的权重</p>
<p>alexnet.id.h   在预测图片的时候使用到</p>
<p>s8，编写pc端代码(参考https://blog.csdn.net/qq_36982160/article/details/79929869)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt; </span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&quot;gesture.id.h&quot; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;net.h&quot; </span><span class="cp"></span>
<span class="c1">//使用ncnn，传入的参数第一个是你需要预测的数据，第二个参数是各个类别的得分vector，注意传入的是地址，这样才能在这个函数中改变其值 </span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">detect_squeezenet</span><span class="p">(</span> <span class="kt">float</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span> <span class="n">cls_scores</span><span class="p">)</span> <span class="p">{</span> 
    <span class="c1">//实例化ncnn：Net，注意include &quot;net.h&quot;，不要在意这时候因为找不到net.h文件而include&lt;net.h&gt;报错，后文会介绍正确的打开方式 </span>
    <span class="n">ncnn</span><span class="o">::</span><span class="n">Net</span> <span class="n">squeezenet</span><span class="p">;</span> 

    <span class="c1">//加载二进制文件，也是照写，后面会介绍对应文件应该放的正确位置 </span>
    <span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="n">squeezenet</span><span class="p">.</span><span class="n">load_param</span><span class="p">(</span><span class="s">&quot;demo.param&quot;</span><span class="p">);</span> 
    <span class="kt">int</span> <span class="n">b</span><span class="o">=</span><span class="n">squeezenet</span><span class="p">.</span><span class="n">load_param_bin</span><span class="p">(</span><span class="s">&quot;demo.bin&quot;</span><span class="p">);</span> 

    <span class="c1">//实例化Mat，前三个参数是维度，第四个参数是传入的data，维度的设置根据你自己的数据进行设置，顺序是w、h、c </span>
    <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span> <span class="n">in</span> <span class="o">=</span> <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span><span class="p">(</span><span class="mi">550</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span> 

    <span class="c1">//实例化Extractor </span>
    <span class="n">ncnn</span><span class="o">::</span><span class="n">Extractor</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">squeezenet</span><span class="p">.</span><span class="n">create_extractor</span><span class="p">();</span> 
    <span class="n">ex</span><span class="p">.</span><span class="n">set_light_mode</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span> 
    <span class="c1">//注意把&quot;data&quot;换成你deploy中的数据层名字 </span>
    <span class="kt">int</span> <span class="n">d</span><span class="o">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">input</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">in</span><span class="p">);</span> 

    <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span> <span class="n">out</span><span class="p">;</span> 
    <span class="c1">//这里是真正的终点，不多说了，只能仰天膜拜nihui大牛，重点是将prob换成你deploy中最后一层的名字 </span>
    <span class="kt">int</span> <span class="n">c</span><span class="o">=</span><span class="n">ex</span><span class="p">.</span><span class="n">extract</span><span class="p">(</span><span class="s">&quot;prob&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span> 

    <span class="c1">//将out中的值转化为我们的cls_scores，这样就可以返回不同类别的得分了 </span>
    <span class="n">cls_scores</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="n">w</span><span class="p">);</span> 
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">out</span><span class="p">.</span><span class="n">w</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">cls_scores</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">j</span><span class="p">];</span> 
        <span class="p">}</span> 
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
    <span class="p">}</span> 

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span> 
    <span class="c1">//注意，这里的argv是之后从终端输入的参数，我这里是数据源的路径,因为我是从两个文件中生成一个总的数据，所以用了argv[1]和argv[2]，你也可以自己根据需求改变 </span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">imagepath1</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> 
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">imagepath2</span><span class="o">=</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> 

    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fopeni</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span> 
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fopenq</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span> 

    <span class="n">fopeni</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">imagepath1</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">);</span> 
    <span class="n">fopenq</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">imagepath2</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">);</span> 

    <span class="c1">//这是我的数据，i和q相当于图片的两个通道 </span>
    <span class="kt">float</span> <span class="n">i</span><span class="p">[</span><span class="mi">4400</span><span class="p">];</span> 
    <span class="kt">float</span> <span class="n">q</span><span class="p">[</span><span class="mi">4400</span><span class="p">];</span> 
    <span class="kt">float</span> <span class="n">data</span><span class="p">[</span><span class="mi">8800</span><span class="p">];</span> 

    <span class="kt">int</span> <span class="n">count</span><span class="o">=</span><span class="mi">4400</span><span class="p">;</span> 
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">fscanf</span><span class="p">(</span><span class="n">fopeni</span><span class="p">,</span><span class="s">&quot;%f&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span> 
        <span class="n">fscanf</span><span class="p">(</span><span class="n">fopenq</span><span class="p">,</span><span class="s">&quot;%f&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span> 
    <span class="p">}</span> 

    <span class="c1">//这是将iq（相当于图片的两个通道的数据）转化为一个一维向量，需要特别注意的是数据维度的顺序 </span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">8800</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">4400</span><span class="p">)</span> <span class="p">{</span> 
            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="n">j</span><span class="p">];</span> 
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span> 
            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">4400</span><span class="p">];</span> 
        <span class="p">}</span> 
    <span class="p">}</span> 

    <span class="kt">char</span> <span class="n">a</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="sc">&#39;A&#39;</span><span class="p">,</span><span class="sc">&#39;B&#39;</span><span class="p">,</span><span class="sc">&#39;C&#39;</span><span class="p">,</span><span class="sc">&#39;F&#39;</span><span class="p">,</span><span class="sc">&#39;G&#39;</span><span class="p">,</span><span class="sc">&#39;H&#39;</span><span class="p">,</span><span class="sc">&#39;I&#39;</span><span class="p">,</span><span class="sc">&#39;J&#39;</span><span class="p">,</span><span class="sc">&#39;K&#39;</span><span class="p">,</span><span class="sc">&#39;L&#39;</span><span class="p">,</span><span class="sc">&#39;M&#39;</span><span class="p">,</span><span class="sc">&#39;N&#39;</span><span class="p">,</span><span class="sc">&#39;O&#39;</span><span class="p">};</span> 

    <span class="c1">//注意，这里是调用ncnn的代码 </span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">cls_scores</span><span class="p">;</span>  <span class="c1">//用来存储最终各类别的得分 </span>
    <span class="c1">//这个函数的实现在上面，快去看 </span>
    <span class="n">detect_squeezenet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cls_scores</span><span class="p">);</span> 
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cls_scores</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c : %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">cls_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> 
    <span class="p">}</span> 

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>代码是最简单的ncnn使用场景，可以根据自己需求加入代码。</p>
<p>s9，编译代码</p>
<p>(1) 编写CMakeLists.txt</p>
<p>在CMakeLists.txt增加如下两行代码</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">add_executable</span><span class="p">(</span><span class="n">demo</span> <span class="n">demo</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span>
<span class="n">target_link_libraries</span><span class="p">(</span><span class="n">demo</span> <span class="n">ncnn</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>CMakeLists.txt如下</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>find_package(OpenCV QUIET COMPONENTS core highgui imgproc imgcodecs) 
if(NOT OpenCV_FOUND) 
    find_package(OpenCV REQUIRED COMPONENTS core highgui imgproc) 
endif() 

include_directories(${CMAKE_CURRENT_SOURCE_DIR}/../src) 
include_directories(${CMAKE_CURRENT_BINARY_DIR}/../src) 

add_executable(squeezenet squeezenet.cpp) 

target_link_libraries(squeezenet ncnn ${OpenCV_LIBS}) 

add_executable(fasterrcnn fasterrcnn.cpp) 
target_link_libraries(fasterrcnn ncnn ${OpenCV_LIBS}) 

add_executable(demo demo.cpp) 
target_link_libraries(demo ncnn) 

add_subdirectory(ssd)
</pre></div>
</td></tr></table>

<p>(2) 在ncnn根目录下CMakeLists.txt中编译examples语句的注释去掉</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##############################################

# add_subdirectory(examples)
# add_subdirectory(benchmark)
add_subdirectory(src)
if(NOT ANDROID AND NOT IOS)
add_subdirectory(tools)
endif()
</pre></div>
</td></tr></table>

<p>(3)ncnn/build目录下进行编译，生成demo可执行文件</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>make
</pre></div>
</td></tr></table>

<p>s10，执行</p>
<p>将生成的.param和.bin文件复制到ncnn/build/examples目录下，然后终端cd到ncnn/build/examples，执行：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./demo data_path1 data_path2
</pre></div>
</td></tr></table>

<h5 id="2-win-x64-visual-studio-community-2017">2. Win x64 (Visual Studio Community 2017)<a class="headerlink" href="#2-win-x64-visual-studio-community-2017" title="Permanent link">&para;</a></h5>
<p>s1，安装Visual Studio Community 2017</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>download Visual Studio Community 2017 from https://visualstudio.microsoft.com/vs/community/
install it
Start → Programs → Visual Studio 2017 → Visual Studio Tools → x64 Native Tools Command Prompt for VS 2017
</pre></div>
</td></tr></table>

<p>s2，编译protobuf</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">download</span> <span class="n">protobuf</span><span class="p">-</span><span class="n">3</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">0</span> <span class="n">from</span> <span class="n">https</span><span class="err">:</span><span class="p">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">google</span><span class="p">/</span><span class="n">protobuf</span><span class="p">/</span><span class="n">archive</span><span class="p">/</span><span class="n">v3</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">zip</span>
<span class="p">&gt;</span> <span class="nb">cd </span><span class="p">&lt;</span><span class="n">protobuf-root-dir</span><span class="p">&gt;</span>
<span class="p">&gt;</span> <span class="n">mkdir</span> <span class="n">build-vs2017</span>
<span class="p">&gt;</span> <span class="nb">cd </span><span class="n">build-vs2017</span>
<span class="p">&gt;</span> <span class="n">cmake</span> <span class="n">-G</span><span class="s2">&quot;NMake Makefiles&quot;</span> <span class="n">-DCMAKE_BUILD_TYPE</span><span class="p">=</span><span class="n">Release</span> <span class="n">-DCMAKE_INSTALL_PREFIX</span><span class="p">=</span><span class="k">%</span><span class="n">cd</span><span class="p">%/</span><span class="n">install</span> <span class="n">-Dprotobuf_BUILD_TESTS</span><span class="p">=</span><span class="n">OFF</span> <span class="n">-Dprotobuf_MSVC_STATIC_RUNTIME</span><span class="p">=</span><span class="n">OFF</span> <span class="p">../</span><span class="n">cmake</span>
<span class="p">&gt;</span> <span class="n">nmake</span>
<span class="p">&gt;</span> <span class="n">nmake</span> <span class="n">install</span>
</pre></div>
</td></tr></table>

<p>s3，编译ncnn库</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">&gt;</span> <span class="nb">cd </span><span class="p">&lt;</span><span class="n">ncnn-root-dir</span><span class="p">&gt;</span>
<span class="p">&gt;</span> <span class="n">mkdir</span> <span class="n">-p</span> <span class="n">build-vs2017</span>
<span class="p">&gt;</span> <span class="nb">cd </span><span class="n">build-vs2017</span>
<span class="p">&gt;</span> <span class="n">cmake</span> <span class="n">-G</span><span class="s2">&quot;NMake Makefiles&quot;</span> <span class="n">-DCMAKE_BUILD_TYPE</span><span class="p">=</span><span class="n">Release</span> <span class="n">-DCMAKE_INSTALL_PREFIX</span><span class="p">=</span><span class="k">%</span><span class="n">cd</span><span class="p">%/</span><span class="n">install</span> <span class="n">-DProtobuf_INCLUDE_DIR</span><span class="p">=&lt;</span><span class="n">protobuf-root-dir</span><span class="p">&gt;/</span><span class="n">build-vs2017</span><span class="p">/</span><span class="n">install</span><span class="p">/</span><span class="n">include</span> <span class="n">-DProtobuf_LIBRARIES</span><span class="p">=&lt;</span><span class="n">protobuf-root-dir</span><span class="p">&gt;/</span><span class="n">build-vs2017</span><span class="p">/</span><span class="n">install</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">libprotobuf</span><span class="p">.</span><span class="n">lib</span> <span class="n">-DProtobuf_PROTOC_EXECUTABLE</span><span class="p">=&lt;</span><span class="n">protobuf-root-dir</span><span class="p">&gt;/</span><span class="n">build-vs2017</span><span class="p">/</span><span class="n">install</span><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">protoc</span><span class="p">.</span><span class="n">exe</span> <span class="p">..</span>
<span class="p">&gt;</span> <span class="n">nmake</span>
<span class="p">&gt;</span> <span class="n">nmake</span> <span class="n">install</span>

<span class="n">pick</span> <span class="n">build-vs2017</span><span class="p">/</span><span class="n">install</span> <span class="n">folder</span> <span class="k">for</span> <span class="n">further</span> <span class="n">usage</span>
</pre></div>
</td></tr></table>

<h5 id="3-androidncnn">3. Android端使用ncnn<a class="headerlink" href="#3-androidncnn" title="Permanent link">&para;</a></h5>
<p>参考：</p>
<p><a href="https://blog.csdn.net/qq_33200967/article/details/82421089">https://blog.csdn.net/qq_33200967/article/details/82421089</a></p>
<p><a href="https://blog.csdn.net/qq_36982160/article/details/79931741">https://blog.csdn.net/qq_36982160/article/details/79931741</a></p>
<p>s1，使用Android Studio安装ndk</p>
<p>1）打开Android Studio，依次点击File-&gt;Settings-&gt;Appearance&amp;Behavior-&gt;System Settings-&gt;Android SDK-&gt;SDK Tool，选中NDK，点击apply自动下载安装(如果安装成功会在SDK目录下生成ndk-bundle文件夹)；</p>
<p>2）配置ndk的环境变量</p>
<ul>
<li>打开profile</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo vim /etc/profile
</pre></div>
</td></tr></table>

<ul>
<li>在profile文件末尾添加ndk路径</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">NDK_HOME</span><span class="o">=</span>sdkroot/ndk-bundle
<span class="nv">PATH</span><span class="o">=</span><span class="nv">$NDK_HOME</span>:<span class="nv">$PATH</span>
</pre></div>
</td></tr></table>

<ul>
<li>保存退出，使用source命令使环境变量生效</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">source</span> /etc/profile
</pre></div>
</td></tr></table>

<ul>
<li>验证ndk是否配置成功</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>ndk-build -v
</pre></div>
</td></tr></table>

<p>s2，编译ncnn sdk</p>
<p>通过如下命令编译ncnn sdk，会在ncnn/build-android下生成install文件夹，其中包括：include(调用ncnn所需的头文件)和lib(编译得到的ncnn库libncnn.a)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mkdir build-android
<span class="nb">cd</span> build-android
cmake -DCMAKE_TOOLCHAIN_FILE<span class="o">=</span><span class="nv">$ANDROID_NDK</span>/build/cmake/android.toolchain.cmake <span class="se">\</span>
    -DANDROID_ABI<span class="o">=</span><span class="s2">&quot;armeabi-v7a&quot;</span> -DANDROID_ARM_NEON<span class="o">=</span>ON <span class="se">\</span>
    -DANDROID_PLATFORM<span class="o">=</span>android-14 ..
make
make install
make package
</pre></div>
</td></tr></table>

<p>参数设置请参考：<a href="https://github.com/Tencent/ncnn/wiki/cmake-%E6%89%93%E5%8C%85-android-sdk">https://github.com/Tencent/ncnn/wiki/cmake-%E6%89%93%E5%8C%85-android-sdk</a></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>ANDROID_ABI 是架构名字，&quot;armeabi-v7a&quot; 支持绝大部分手机硬件
ANDROID_ARM_NEON 是否使用 NEON 指令集，设为 ON 支持绝大部分手机硬件
ANDROID_PLATFORM 指定最低系统版本，&quot;android-14&quot; 就是 android-4.0
</pre></div>
</td></tr></table>

<p>s3，对源码进行编译</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>git clone https://github.com/Tencent/ncnn
$ <span class="nb">cd</span> &lt;ncnn-root-dir&gt;
$ mkdir -p build
$ <span class="nb">cd</span> build
$ cmake ..
$ make -j4
</pre></div>
</td></tr></table>

<p>s4，准备caffe模型文件(alexnet)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>deploy.prototxt  
snapshot_10000.caffemodel  
</pre></div>
</td></tr></table>

<p>alexnet   <a href="https://github.com/BVLC/caffe/tree/master/models/bvlc_alexnet">deploy.prototxt</a>， <a href="http://dl.caffe.berkeleyvision.org/bvlc_alexnet.caffemodel">caffemodel</a></p>
<p>s5，使用ncnn转换工具将旧caffe版本的prototxt和caffemodel转新版本</p>
<p>将旧caffe版本的prototxt和caffemodel存放在caffe/build/tools目录下，执行如下命令完成转换</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./upgrade_net_proto_text <span class="o">[</span>old prototxt<span class="o">]</span> <span class="o">[</span>new prototxt<span class="o">]</span>
./upgrade_net_proto_binary <span class="o">[</span>old caffemodel<span class="o">]</span> <span class="o">[</span>new caffemodel<span class="o">]</span>
</pre></div>
</td></tr></table>

<p>s6，将deploy.prototxt中输入层替换成input层(如果只读取一张图片将dim设置为1)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">layer</span> <span class="p">{</span>
  <span class="n">name</span><span class="o">:</span> <span class="s">&quot;data&quot;</span>
  <span class="n">type</span><span class="o">:</span> <span class="s">&quot;Input&quot;</span>
  <span class="n">top</span><span class="o">:</span> <span class="s">&quot;data&quot;</span>
  <span class="n">input_param</span> <span class="p">{</span> <span class="n">shape</span><span class="o">:</span> <span class="p">{</span> <span class="n">dim</span><span class="o">:</span> <span class="mi">1</span> <span class="n">dim</span><span class="o">:</span> <span class="mi">3</span> <span class="n">dim</span><span class="o">:</span> <span class="mi">227</span> <span class="n">dim</span><span class="o">:</span> <span class="mi">227</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>s7，使用caffe2ncnn工具将caffe model转成ncnn model</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./caffe2ncnn deploy.prototxt bvlc_alexnet.caffemodel alexnet.param alexnet.bin
</pre></div>
</td></tr></table>

<p>在ncnn/build/tools目录下生成param和bin文件。</p>
<p>s8，对模型参数进行加密</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./ncnn2mem alexnet.param alexnet.bin alexnet.id.h alexnet.mem.h
</pre></div>
</td></tr></table>

<p>在ncnn/build/tools目录下生成.param、.bin和.h文件。</p>
<p>alexnet.param    网络的模型参数</p>
<p>alexnet.bin   网络的权重</p>
<p>alexnet.id.h   在预测图片的时候使用到</p>
<p>s9，开发安卓项目</p>
<p>(1)在Android Studio上创建一个NCNN1，并选择Include C++ support</p>
<p><img alt="这里写图片描述" src="https://img-blog.csdn.net/20180905204155999?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzMjAwOTY3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" /></p>
<p>(2)在main目录下创建assets目录，并将alexnet.param、alexnet.bin、label.txt拷贝其中</p>
<p>(3)将include文件夹和 alexnet.id.h拷贝到cpp目录下</p>
<p>(4)在main目录下创建jniLibs/armeabi-v7a/目录，并将alexnet.id.h 拷贝其中</p>
<p>(5)在cpp文件夹下创建C++文件，用于加载模型和预测图片</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;android/bitmap.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;android/log.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;jni.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="c1">// ncnn</span>
<span class="cp">#include</span> <span class="cpf">&quot;include/net.h&quot; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;alexnet.id.h&quot; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/time.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp"></span>
<span class="k">static</span> <span class="n">ncnn</span><span class="o">::</span><span class="n">UnlockedPoolAllocator</span> <span class="n">g_blob_pool_allocator</span><span class="p">;</span> 
<span class="k">static</span> <span class="n">ncnn</span><span class="o">::</span><span class="n">PoolAllocator</span> <span class="n">g_workspace_pool_allocator</span><span class="p">;</span> 
<span class="k">static</span> <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span> <span class="n">ncnn_param</span><span class="p">;</span> 
<span class="k">static</span> <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span> <span class="n">ncnn_bin</span><span class="p">;</span> 
<span class="k">static</span> <span class="n">ncnn</span><span class="o">::</span><span class="n">Net</span> <span class="n">ncnn_net</span><span class="p">;</span> 
<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span> 
<span class="c1">// public native boolean Init(byte[] param, byte[] bin, byte[] words); JNIEXPORT jboolean JNICALL </span>
<span class="n">Java_com_example_ncnn1_NcnnJni_Init</span><span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">thiz</span><span class="p">,</span> <span class="n">jbyteArray</span> <span class="n">param</span><span class="p">,</span> <span class="n">jbyteArray</span> <span class="n">bin</span><span class="p">)</span> <span class="p">{</span> 
    <span class="c1">// init param </span>
    <span class="p">{</span> 
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">(</span><span class="n">param</span><span class="p">);</span> 
        <span class="n">ncnn_param</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="mi">1u</span><span class="p">);</span> 
        <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetByteArrayRegion</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="p">(</span><span class="n">jbyte</span> <span class="o">*</span><span class="p">)</span> <span class="n">ncnn_param</span><span class="p">);</span> <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">ncnn_net</span><span class="p">.</span><span class="n">load_param</span><span class="p">((</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">ncnn_param</span><span class="p">);</span> 
        <span class="n">__android_log_print</span><span class="p">(</span><span class="n">ANDROID_LOG_DEBUG</span><span class="p">,</span> <span class="s">&quot;NcnnJni&quot;</span><span class="p">,</span> <span class="s">&quot;load_param %d %d&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span> 
    <span class="p">}</span> 

    <span class="c1">// init bin </span>
    <span class="p">{</span> 
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">(</span><span class="n">bin</span><span class="p">);</span> 
        <span class="n">ncnn_bin</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="mi">1u</span><span class="p">);</span> 
        <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetByteArrayRegion</span><span class="p">(</span><span class="n">bin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="p">(</span><span class="n">jbyte</span> <span class="o">*</span><span class="p">)</span> <span class="n">ncnn_bin</span><span class="p">);</span> 
        <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">ncnn_net</span><span class="p">.</span><span class="n">load_model</span><span class="p">((</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">ncnn_bin</span><span class="p">);</span> 
        <span class="n">__android_log_print</span><span class="p">(</span><span class="n">ANDROID_LOG_DEBUG</span><span class="p">,</span> <span class="s">&quot;NcnnJni&quot;</span><span class="p">,</span> <span class="s">&quot;load_model %d %d&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span> 
    <span class="p">}</span> 

    <span class="n">ncnn</span><span class="o">::</span><span class="n">Option</span> <span class="n">opt</span><span class="p">;</span> 
    <span class="n">opt</span><span class="p">.</span><span class="n">lightmode</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> 
    <span class="n">opt</span><span class="p">.</span><span class="n">num_threads</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> 
    <span class="n">opt</span><span class="p">.</span><span class="n">blob_allocator</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g_blob_pool_allocator</span><span class="p">;</span> 
    <span class="n">opt</span><span class="p">.</span><span class="n">workspace_allocator</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g_workspace_pool_allocator</span><span class="p">;</span> 

    <span class="n">ncnn</span><span class="o">::</span><span class="n">set_default_option</span><span class="p">(</span><span class="n">opt</span><span class="p">);</span> 

    <span class="k">return</span> <span class="n">JNI_TRUE</span><span class="p">;</span> 
<span class="p">}</span> 

<span class="c1">// public native String Detect(Bitmap bitmap); </span>
<span class="n">JNIEXPORT</span> <span class="n">jfloatArray</span> <span class="n">JNICALL</span> <span class="n">Java_com_example_ncnn1_NcnnJni_Detect</span><span class="p">(</span><span class="n">JNIEnv</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">thiz</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">bitmap</span><span class="p">)</span> 
<span class="p">{</span> 
    <span class="c1">// ncnn from bitmap </span>
    <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span> <span class="n">in</span><span class="p">;</span> 
    <span class="p">{</span> 
        <span class="n">AndroidBitmapInfo</span> <span class="n">info</span><span class="p">;</span> 
        <span class="n">AndroidBitmap_getInfo</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">);</span> 
        <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">width</span><span class="p">;</span> <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">height</span><span class="p">;</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">format</span> <span class="o">!=</span> <span class="n">ANDROID_BITMAP_FORMAT_RGBA_8888</span><span class="p">)</span> 
            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span> 

        <span class="kt">void</span><span class="o">*</span> <span class="n">indata</span><span class="p">;</span> 
        <span class="n">AndroidBitmap_lockPixels</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">indata</span><span class="p">);</span> 
        <span class="c1">// 把像素转换成data，并指定通道顺序 </span>
        <span class="n">in</span> <span class="o">=</span> <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span><span class="o">::</span><span class="n">from_pixels</span><span class="p">((</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">indata</span><span class="p">,</span> <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span><span class="o">::</span><span class="n">PIXEL_RGBA2BGR</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span> 
        <span class="n">AndroidBitmap_unlockPixels</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">);</span> 
    <span class="p">}</span> 

    <span class="c1">// ncnn_net </span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">cls_scores</span><span class="p">;</span> 
    <span class="p">{</span> 
        <span class="c1">// 减去均值和乘上比例 </span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">mean_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">103.94f</span><span class="p">,</span> <span class="mf">116.78f</span><span class="p">,</span> <span class="mf">123.68f</span><span class="p">};</span> 
        <span class="k">const</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.017f</span><span class="p">,</span> <span class="mf">0.017f</span><span class="p">,</span> <span class="mf">0.017f</span><span class="p">};</span> 

        <span class="n">in</span><span class="p">.</span><span class="n">substract_mean_normalize</span><span class="p">(</span><span class="n">mean_vals</span><span class="p">,</span> <span class="n">scale</span><span class="p">);</span> 

        <span class="n">ncnn</span><span class="o">::</span><span class="n">Extractor</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">ncnn_net</span><span class="p">.</span><span class="n">create_extractor</span><span class="p">();</span> 
        <span class="c1">// 如果时不加密是使用ex.input(&quot;data&quot;, in); </span>
        <span class="n">ex</span><span class="p">.</span><span class="n">input</span><span class="p">(</span><span class="n">mobilenet_v2_param_id</span><span class="o">::</span><span class="n">BLOB_data</span><span class="p">,</span> <span class="n">in</span><span class="p">);</span> 

        <span class="n">ncnn</span><span class="o">::</span><span class="n">Mat</span> <span class="n">out</span><span class="p">;</span> 
        <span class="c1">// 如果时不加密是使用ex.extract(&quot;prob&quot;, out); </span>
        <span class="n">ex</span><span class="p">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mobilenet_v2_param_id</span><span class="o">::</span><span class="n">BLOB_prob</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span> 

        <span class="kt">int</span> <span class="n">output_size</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">w</span><span class="p">;</span> 
        <span class="n">jfloat</span> <span class="o">*</span><span class="n">output</span><span class="p">[</span><span class="n">output_size</span><span class="p">];</span> 
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">out</span><span class="p">.</span><span class="n">w</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
            <span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">[</span><span class="n">j</span><span class="p">];</span> 
        <span class="p">}</span> 

        <span class="n">jfloatArray</span> <span class="n">jOutputData</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">NewFloatArray</span><span class="p">(</span><span class="n">output_size</span><span class="p">);</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">jOutputData</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span> <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span> 

        <span class="n">env</span><span class="o">-&gt;</span><span class="n">SetFloatArrayRegion</span><span class="p">(</span><span class="n">jOutputData</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">jfloat</span> <span class="o">*&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">output</span><span class="p">));</span> <span class="c1">// copy </span>
        <span class="k">return</span> <span class="n">jOutputData</span><span class="p">;</span> 
    <span class="p">}</span> 
<span class="p">}</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>(6)在项目包com.example.ncnn1下，修改MainActivity.java中的代码</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ncnn1</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.Manifest</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.content.pm.PackageManager</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.content.res.AssetManager</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.graphics.Bitmap</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.graphics.BitmapFactory</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.net.Uri</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.support.annotation.NonNull</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.support.annotation.Nullable</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.support.v4.app.ActivityCompat</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.support.v4.content.ContextCompat</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.text.method.ScrollingMovementMethod</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.widget.ImageView</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.widget.Toast</span><span class="o">;</span> 

<span class="kn">import</span> <span class="nn">com.bumptech.glide.Glide</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">com.bumptech.glide.load.engine.DiskCacheStrategy</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">com.bumptech.glide.request.RequestOptions</span><span class="o">;</span> 

<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">java.io.FileNotFoundException</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span> 

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span> 
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span> 
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">USE_PHOTO</span> <span class="o">=</span> <span class="mi">1001</span><span class="o">;</span> 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">camera_image_path</span><span class="o">;</span> 
    <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">show_image</span><span class="o">;</span> 
    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">result_text</span><span class="o">;</span> 
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">load_result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="kd">private</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">ddims</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">224</span><span class="o">,</span> <span class="mi">224</span><span class="o">};</span> 
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">model_index</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> 
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">resultLabel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span> 
    <span class="kd">private</span> <span class="n">NcnnJni</span> <span class="n">squeezencnn</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NcnnJni</span><span class="o">();</span>

    <span class="nd">@Override</span> 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span> 
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span> 
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span> 

        <span class="k">try</span> <span class="o">{</span> 
            <span class="n">initSqueezeNcnn</span><span class="o">();</span> 
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;MainActivity&quot;</span><span class="o">,</span> <span class="s">&quot;initSqueezeNcnn error&quot;</span><span class="o">);</span> 
        <span class="o">}</span> 

        <span class="n">init_view</span><span class="o">();</span> 
        <span class="n">readCacheLabelFromLocalFile</span><span class="o">();</span> 
    <span class="o">}</span> 

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initSqueezeNcnn</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span> 
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">param</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> 
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bin</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> 

        <span class="o">{</span> 
            <span class="n">InputStream</span> <span class="n">assetsInputStream</span> <span class="o">=</span> <span class="n">getAssets</span><span class="o">().</span><span class="na">open</span><span class="o">(</span><span class="s">&quot;mobilenet_v2.param.bin&quot;</span><span class="o">);</span> 
            <span class="kt">int</span> <span class="n">available</span> <span class="o">=</span> <span class="n">assetsInputStream</span><span class="o">.</span><span class="na">available</span><span class="o">();</span> 
            <span class="n">param</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">available</span><span class="o">];</span> 
            <span class="kt">int</span> <span class="n">byteCode</span> <span class="o">=</span> <span class="n">assetsInputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">param</span><span class="o">);</span> 
            <span class="n">assetsInputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> 
        <span class="o">}</span>

        <span class="o">{</span> 
            <span class="n">InputStream</span> <span class="n">assetsInputStream</span> <span class="o">=</span> <span class="n">getAssets</span><span class="o">().</span><span class="na">open</span><span class="o">(</span><span class="s">&quot;mobilenet_v2.bin&quot;</span><span class="o">);</span> 
            <span class="kt">int</span> <span class="n">available</span> <span class="o">=</span> <span class="n">assetsInputStream</span><span class="o">.</span><span class="na">available</span><span class="o">();</span> 
            <span class="n">bin</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">available</span><span class="o">];</span> 
            <span class="kt">int</span> <span class="n">byteCode</span> <span class="o">=</span> <span class="n">assetsInputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bin</span><span class="o">);</span> 
            <span class="n">assetsInputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> 
        <span class="o">}</span> 

        <span class="n">load_result</span> <span class="o">=</span> <span class="n">squeezencnn</span><span class="o">.</span><span class="na">Init</span><span class="o">(</span><span class="n">param</span><span class="o">,</span> <span class="n">bin</span><span class="o">);</span> 
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&quot;load model&quot;</span><span class="o">,</span> <span class="s">&quot;result:&quot;</span> <span class="o">+</span> <span class="n">load_result</span><span class="o">);</span> 
    <span class="o">}</span> 

    <span class="c1">// initialize view </span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">init_view</span><span class="o">()</span> <span class="o">{</span> 
        <span class="n">request_permissions</span><span class="o">();</span> 
        <span class="n">show_image</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">show_image</span><span class="o">);</span> 
        <span class="n">result_text</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">result_text</span><span class="o">);</span>
        <span class="n">result_text</span><span class="o">.</span><span class="na">setMovementMethod</span><span class="o">(</span><span class="n">ScrollingMovementMethod</span><span class="o">.</span><span class="na">getInstance</span><span class="o">());</span> 
        <span class="n">Button</span> <span class="n">use_photo</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">use_photo</span><span class="o">);</span> 

        <span class="c1">// use photo click </span>
        <span class="n">use_photo</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span> 
            <span class="nd">@Override</span> 
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span> 
                <span class="k">if</span> <span class="o">(!</span><span class="n">load_result</span><span class="o">)</span> <span class="o">{</span> 
                    <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;never load model&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span> 
                    <span class="k">return</span><span class="o">;</span> 
                <span class="o">}</span> 
                <span class="n">PhotoUtil</span><span class="o">.</span><span class="na">use_photo</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">USE_PHOTO</span><span class="o">);</span> 
            <span class="o">}</span> 
        <span class="o">});</span> 
    <span class="o">}</span> 

    <span class="c1">// load label&#39;s name </span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">readCacheLabelFromLocalFile</span><span class="o">()</span> <span class="o">{</span> 
        <span class="k">try</span> <span class="o">{</span> 
            <span class="n">AssetManager</span> <span class="n">assetManager</span> <span class="o">=</span> <span class="n">getApplicationContext</span><span class="o">().</span><span class="na">getAssets</span><span class="o">();</span> 
            <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">assetManager</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">&quot;synset.txt&quot;</span><span class="o">)));</span> 
            <span class="n">String</span> <span class="n">readLine</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> 
            <span class="k">while</span> <span class="o">((</span><span class="n">readLine</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> 
                <span class="n">resultLabel</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">readLine</span><span class="o">);</span> 
            <span class="o">}</span> 
            <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> 
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;labelCache&quot;</span><span class="o">,</span> <span class="s">&quot;error &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span> 
        <span class="o">}</span> 
    <span class="o">}</span> 

    <span class="nd">@Override</span> 
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span> 
        <span class="n">String</span> <span class="n">image_path</span><span class="o">;</span> 
        <span class="n">RequestOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RequestOptions</span><span class="o">().</span><span class="na">skipMemoryCache</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">diskCacheStrategy</span><span class="o">(</span><span class="n">DiskCacheStrategy</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span> 
        <span class="k">if</span> <span class="o">(</span><span class="n">resultCode</span> <span class="o">==</span> <span class="n">Activity</span><span class="o">.</span><span class="na">RESULT_OK</span><span class="o">)</span> <span class="o">{</span> 
            <span class="k">switch</span> <span class="o">(</span><span class="n">requestCode</span><span class="o">)</span> <span class="o">{</span> 
                <span class="k">case</span> <span class="n">USE_PHOTO</span><span class="o">:</span> 
                    <span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> 
                        <span class="n">Log</span><span class="o">.</span><span class="na">w</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;user photo data is null&quot;</span><span class="o">);</span> 
                        <span class="k">return</span><span class="o">;</span> 
                    <span class="o">}</span> 
                    <span class="n">Uri</span> <span class="n">image_uri</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span> 
                    <span class="n">Glide</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">image_uri</span><span class="o">).</span><span class="na">apply</span><span class="o">(</span><span class="n">options</span><span class="o">).</span><span class="na">into</span><span class="o">(</span><span class="n">show_image</span><span class="o">);</span> 
                    <span class="c1">// get image path from uri </span>
                    <span class="n">image_path</span> <span class="o">=</span> <span class="n">PhotoUtil</span><span class="o">.</span><span class="na">get_path_from_URI</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">image_uri</span><span class="o">);</span> 
                    <span class="c1">// predict image </span>
                    <span class="n">predict_image</span><span class="o">(</span><span class="n">image_path</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span> 
            <span class="o">}</span> 
        <span class="o">}</span> 
    <span class="o">}</span> 

    <span class="c1">//  predict image </span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">predict_image</span><span class="o">(</span><span class="n">String</span> <span class="n">image_path</span><span class="o">)</span> <span class="o">{</span> 
        <span class="c1">// picture to float array </span>
        <span class="n">Bitmap</span> <span class="n">bmp</span> <span class="o">=</span> <span class="n">PhotoUtil</span><span class="o">.</span><span class="na">getScaleBitmap</span><span class="o">(</span><span class="n">image_path</span><span class="o">);</span> 
        <span class="n">Bitmap</span> <span class="n">rgba</span> <span class="o">=</span> <span class="n">bmp</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">Bitmap</span><span class="o">.</span><span class="na">Config</span><span class="o">.</span><span class="na">ARGB_8888</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span> 

        <span class="c1">// resize to 227x227 </span>
        <span class="n">Bitmap</span> <span class="n">input_bmp</span> <span class="o">=</span> <span class="n">Bitmap</span><span class="o">.</span><span class="na">createScaledBitmap</span><span class="o">(</span><span class="n">rgba</span><span class="o">,</span> <span class="n">ddims</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span> <span class="n">ddims</span><span class="o">[</span><span class="mi">3</span><span class="o">],</span> <span class="kc">false</span><span class="o">);</span> 
        <span class="k">try</span> <span class="o">{</span> 
            <span class="c1">// Data format conversion takes too long </span>
            <span class="c1">// Log.d(&quot;inputData&quot;, Arrays.toString(inputData)); </span>
            <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span> 
            <span class="c1">// get predict result </span>
            <span class="kt">float</span><span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="n">squeezencnn</span><span class="o">.</span><span class="na">Detect</span><span class="o">(</span><span class="n">input_bmp</span><span class="o">);</span> 
            <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span> 
            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;origin predict result:&quot;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">result</span><span class="o">));</span> 
            <span class="kt">long</span> <span class="n">time</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">;</span> <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&quot;result length&quot;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">length</span><span class="o">));</span> 
            <span class="c1">// show predict result and time </span>
            <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">get_max_result</span><span class="o">(</span><span class="n">result</span><span class="o">);</span> 
            <span class="n">String</span> <span class="n">show_text</span> <span class="o">=</span> <span class="s">&quot;result：&quot;</span> <span class="o">+</span> <span class="n">r</span> <span class="o">+</span> <span class="s">&quot;\nname：&quot;</span> <span class="o">+</span> <span class="n">resultLabel</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">r</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;\nprobability：&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">[</span><span class="n">r</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot;\ntime：&quot;</span> <span class="o">+</span> <span class="n">time</span> <span class="o">+</span> <span class="s">&quot;ms&quot;</span><span class="o">;</span> 
            <span class="n">result_text</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">show_text</span><span class="o">);</span> 
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span> 
        <span class="o">}</span> 
    <span class="o">}</span> 

    <span class="c1">// get max probability label </span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">get_max_result</span><span class="o">(</span><span class="kt">float</span><span class="o">[]</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span> 
        <span class="kt">float</span> <span class="n">probability</span> <span class="o">=</span> <span class="n">result</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span> 
        <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> 
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span> 
            <span class="k">if</span> <span class="o">(</span><span class="n">probability</span> <span class="o">&lt;</span> <span class="n">result</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">{</span> 
                <span class="n">probability</span> <span class="o">=</span> <span class="n">result</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> 
                <span class="n">r</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span> 
            <span class="o">}</span>
        <span class="o">}</span> 
        <span class="k">return</span> <span class="n">r</span><span class="o">;</span> 
    <span class="o">}</span> 

    <span class="c1">// request permissions </span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">request_permissions</span><span class="o">()</span> <span class="o">{</span> 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">permissionList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span> 
        <span class="k">if</span> <span class="o">(</span><span class="n">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">)</span> <span class="o">!=</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">permissionList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">);</span> 
        <span class="o">}</span> 

        <span class="k">if</span> <span class="o">(</span><span class="n">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span><span class="o">)</span> <span class="o">!=</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">permissionList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span><span class="o">);</span> 
        <span class="o">}</span> 

        <span class="k">if</span> <span class="o">(</span><span class="n">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="o">)</span> <span class="o">!=</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">permissionList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="o">);</span> 
        <span class="o">}</span> 

        <span class="c1">// if list is not empty will request permissions </span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">permissionList</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span> 
            <span class="n">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">permissionList</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">permissionList</span><span class="o">.</span><span class="na">size</span><span class="o">()]),</span> <span class="mi">1</span><span class="o">);</span> 
        <span class="o">}</span> 
    <span class="o">}</span> 

    <span class="nd">@Override</span> 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestPermissionsResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="nd">@NonNull</span> <span class="n">String</span><span class="o">[]</span> <span class="n">permissions</span><span class="o">,</span> <span class="nd">@NonNull</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">grantResults</span><span class="o">)</span> <span class="o">{</span> 
        <span class="kd">super</span><span class="o">.</span><span class="na">onRequestPermissionsResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">permissions</span><span class="o">,</span> <span class="n">grantResults</span><span class="o">);</span> 
        <span class="k">switch</span> <span class="o">(</span><span class="n">requestCode</span><span class="o">)</span> <span class="o">{</span> 
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> 
                <span class="k">if</span> <span class="o">(</span><span class="n">grantResults</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span> 
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">grantResults</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span> 
                        <span class="kt">int</span> <span class="n">grantResult</span> <span class="o">=</span> <span class="n">grantResults</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> 
                        <span class="k">if</span> <span class="o">(</span><span class="n">grantResult</span> <span class="o">==</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_DENIED</span><span class="o">)</span> <span class="o">{</span> 
                            <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">permissions</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> 
                            <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&quot; permission was denied&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span> 
                        <span class="o">}</span> 
                    <span class="o">}</span> 
                <span class="o">}</span> 
                <span class="k">break</span><span class="o">;</span> 
        <span class="o">}</span> 
    <span class="o">}</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>(7)在项目的包com.example.ncnn1下，创建一个NcnnJni.java类，用于提供JNI接口，代码如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ncnn1</span><span class="o">;</span> 

<span class="kn">import</span> <span class="nn">android.graphics.Bitmap</span><span class="o">;</span> 

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NcnnJni</span> <span class="o">{</span> 
    <span class="kd">public</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">Init</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">param</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bin</span><span class="o">);</span> 
    <span class="kd">public</span> <span class="kd">native</span> <span class="kt">float</span><span class="o">[]</span> <span class="nf">Detect</span><span class="o">(</span><span class="n">Bitmap</span> <span class="n">bitmap</span><span class="o">);</span> 

    <span class="kd">static</span> <span class="o">{</span> 
        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&quot;ncnn_jni&quot;</span><span class="o">);</span> 
    <span class="o">}</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>(8)在项目的包com.example.ncnn1下，创建一个PhotoUtil.java类，这个是图片的工具类，代码如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ncnn1</span><span class="o">;</span> 

<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.database.Cursor</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.graphics.Bitmap</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.graphics.BitmapFactory</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.net.Uri</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">android.provider.MediaStore</span><span class="o">;</span> 
<span class="kn">import</span> <span class="nn">java.nio.FloatBuffer</span><span class="o">;</span> 

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PhotoUtil</span> <span class="o">{</span> 
    <span class="c1">// get picture in photo </span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">use_photo</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">,</span> <span class="kt">int</span> <span class="n">requestCode</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_PICK</span><span class="o">);</span> 
        <span class="n">intent</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="s">&quot;image/*&quot;</span><span class="o">);</span> 
        <span class="n">activity</span><span class="o">.</span><span class="na">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">requestCode</span><span class="o">);</span> 
    <span class="o">}</span> 

    <span class="c1">// get photo from Uri </span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">get_path_from_URI</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span> 
        <span class="n">String</span> <span class="n">result</span><span class="o">;</span> 
        <span class="n">Cursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getContentResolver</span><span class="o">().</span><span class="na">query</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span> 
        <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">result</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="na">getPath</span><span class="o">();</span> 
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> 
            <span class="n">cursor</span><span class="o">.</span><span class="na">moveToFirst</span><span class="o">();</span> 
            <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">ImageColumns</span><span class="o">.</span><span class="na">DATA</span><span class="o">);</span> 
            <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span> 
            <span class="n">cursor</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> 
        <span class="o">}</span> 
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span> 
    <span class="o">}</span> 

    <span class="c1">// compress picture </span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Bitmap</span> <span class="nf">getScaleBitmap</span><span class="o">(</span><span class="n">String</span> <span class="n">filePath</span><span class="o">)</span> <span class="o">{</span> 
        <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">Options</span> <span class="n">opt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">Options</span><span class="o">();</span> 
        <span class="n">opt</span><span class="o">.</span><span class="na">inJustDecodeBounds</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> 
        <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeFile</span><span class="o">(</span><span class="n">filePath</span><span class="o">,</span> <span class="n">opt</span><span class="o">);</span> 

        <span class="kt">int</span> <span class="n">bmpWidth</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="na">outWidth</span><span class="o">;</span> 
        <span class="kt">int</span> <span class="n">bmpHeight</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="na">outHeight</span><span class="o">;</span> 

        <span class="kt">int</span> <span class="n">maxSize</span> <span class="o">=</span> <span class="mi">500</span><span class="o">;</span> 

        <span class="c1">// compress picture with inSampleSize </span>
        <span class="n">opt</span><span class="o">.</span><span class="na">inSampleSize</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> 
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span> 
            <span class="k">if</span> <span class="o">(</span><span class="n">bmpWidth</span> <span class="o">/</span> <span class="n">opt</span><span class="o">.</span><span class="na">inSampleSize</span> <span class="o">&lt;</span> <span class="n">maxSize</span> <span class="o">||</span> <span class="n">bmpHeight</span> <span class="o">/</span> <span class="n">opt</span><span class="o">.</span><span class="na">inSampleSize</span> <span class="o">&lt;</span> <span class="n">maxSize</span><span class="o">)</span> <span class="o">{</span> 
                <span class="k">break</span><span class="o">;</span> 
            <span class="o">}</span> 
            <span class="n">opt</span><span class="o">.</span><span class="na">inSampleSize</span> <span class="o">*=</span> <span class="mi">2</span><span class="o">;</span> 
        <span class="o">}</span> 
        <span class="n">opt</span><span class="o">.</span><span class="na">inJustDecodeBounds</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> 
        <span class="k">return</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeFile</span><span class="o">(</span><span class="n">filePath</span><span class="o">,</span> <span class="n">opt</span><span class="o">);</span> 
    <span class="o">}</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>(9)修改启动页面的布局，修改如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> 
<span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">xmlns:app=</span><span class="s">&quot;http://schemas.android.com/apk/res-auto&quot;</span>
    <span class="na">xmlns:tools=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="na">tools:context=</span><span class="s">&quot;.MainActivity&quot;</span><span class="nt">&gt;</span> 

    <span class="nt">&lt;LinearLayout</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/btn_ll&quot;</span>
        <span class="na">android:layout_alignParentBottom=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:orientation=</span><span class="s">&quot;horizontal&quot;</span><span class="nt">&gt;</span> 

        <span class="nt">&lt;Button</span>
            <span class="na">android:id=</span><span class="s">&quot;@+id/use_photo&quot;</span>
            <span class="na">android:layout_weight=</span><span class="s">&quot;1&quot;</span>
            <span class="na">android:layout_width=</span><span class="s">&quot;0dp&quot;</span>
            <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
            <span class="na">android:text=</span><span class="s">&quot;相册&quot;</span> <span class="nt">/&gt;</span> 

    <span class="nt">&lt;/LinearLayout&gt;</span> 

    <span class="nt">&lt;TextView</span>
        <span class="na">android:layout_above=</span><span class="s">&quot;@id/btn_ll&quot;</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/result_text&quot;</span>
        <span class="na">android:textSize=</span><span class="s">&quot;16sp&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:hint=</span><span class="s">&quot;预测结果会在这里显示&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;100dp&quot;</span> <span class="nt">/&gt;</span> 
    <span class="nt">&lt;ImageView</span>
        <span class="na">android:layout_alignParentTop=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:layout_above=</span><span class="s">&quot;@id/result_text&quot;</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/show_image&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span> <span class="nt">/&gt;</span> 
<span class="nt">&lt;/RelativeLayout&gt;</span>
</pre></div>
</td></tr></table>

<p>(10)修改APP目录下的CMakeLists.txt文件，修改如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># For more information about using CMake with Android Studio, read the 
# documentation: https://d.android.com/studio/projects/add-native-code.html 

# Sets the minimum version of CMake required to build the native library. 

cmake_minimum_required(VERSION 3.4.1) 

# Creates and names a library, sets it as either STATIC 
# or SHARED, and provides the relative paths to its source code. 
# You can define multiple libraries, and CMake builds them for you. 
# Gradle automatically packages shared libraries with your APK. 
set(ncnn_lib ${CMAKE_SOURCE_DIR}/src/main/jniLibs/armeabi-v7a/libncnn.a) 
add_library (ncnn_lib STATIC IMPORTED) 
set_target_properties(ncnn_lib PROPERTIES IMPORTED_LOCATION ${ncnn_lib}) 

add_library( # Sets the name of the library. 
            ncnn_jni 
            # Sets the library as a shared library. 
            SHARED 

            # Provides a relative path to your source file(s). 
            src/main/cpp/ncnn_jni.cpp ) 

# Searches for a specified prebuilt library and stores the path as a 
# variable. Because CMake includes system libraries in the search path by 
# default, you only need to specify the name of the public NDK library 
# you want to add. CMake verifies that the library exists before 
# completing its build. 

find_library( # Sets the name of the path variable. 
                log-lib 

                # Specifies the name of the NDK library that 
                # you want CMake to locate. 
                log ) 

# Specifies libraries CMake should link to your target library. You 
# can link multiple libraries, such as libraries you define in this 
# build script, prebuilt third-party libraries, or system libraries. 

target_link_libraries( # Specifies the target library. 
                        ncnn_jni 
                        ncnn_lib 
                        jnigraphics 

                        # Links the target library to the log library 
                        # included in the NDK. 
                        ${log-lib} )
</pre></div>
</td></tr></table>

<p>(11)修改APP目录下的build.gradle文件，修改如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>apply plugin: &#39;com.android.application&#39; 

android { 
    compileSdkVersion 28 
    defaultConfig { 
        applicationId &quot;com.example.ncnn1&quot; 
        minSdkVersion 21 
        targetSdkVersion 28 
        versionCode 1 
        versionName &quot;1.0&quot; 
        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot; 
        externalNativeBuild { 
            cmake { 
                cppFlags &quot;-std=c++11 -fopenmp&quot; 
                abiFilters &quot;armeabi-v7a&quot; 
            }
        }
    } 
    buildTypes { 
        release { 
            minifyEnabled false 
            proguardFiles getDefaultProguardFile(&#39;proguard-android.txt&#39;), &#39;proguard-rules.pro&#39; 
        }
    } 
    externalNativeBuild { 
        cmake { 
            path &quot;CMakeLists.txt&quot; 
        } 
    } 

    sourceSets { 
        main { 
            jniLibs.srcDirs = [&quot;src/main/jniLibs&quot;] 
            jni.srcDirs = [&#39;src/cpp&#39;] 
        }
    } 
} 

dependencies { 
    implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;]) 
    implementation &#39;com.android.support:appcompat-v7:28.0.0-rc02&#39; 
    implementation &#39;com.android.support.constraint:constraint-layout:1.1.3&#39; 
    testImplementation &#39;junit:junit:4.12&#39; 
    implementation &#39;com.github.bumptech.glide:glide:4.3.1&#39; 
    androidTestImplementation &#39;com.android.support.test:runner:1.0.2&#39; 
    androidTestImplementation &#39;com.android.support.test.espresso:espresso-core:3.0.2&#39; 
}
</pre></div>
</td></tr></table>

<p>(12)最后在配置文件中添加权限</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span><span class="nt">/&gt;</span> 
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</td></tr></table>

<p>(13)编译完成</p>
                
                  
                
              
              
                


  <h2 id="__comments">评论</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://hai5g.cn/aiwiki/qa500/ch17_模型压缩、加速及移动端部署/17.8.1 NCNN部署/";
      this.page.identifier =
        "/qa500/ch17_模型压缩、加速及移动端部署/17.8.1 NCNN部署/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//AI-Wiki.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 AI Wiki Team
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.39abc4af.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="https://cdn.jsdelivr.net/gh/ethantw/Han@3.3.0/dist/han.min.js"></script>
      
        <script src="../../../_static/js/extra.js?v=10"></script>
      
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>