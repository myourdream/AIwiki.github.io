



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="AI Wiki 是一个编程竞赛知识整合站点，提供有趣又实用的编程竞赛知识以及其他有帮助的内容，帮助广大编程竞赛爱好者更快更深入地学习编程竞赛">
      
      
        <link rel="canonical" href="https://hai5g.cn/aiwiki/ds/splay/">
      
      
        <meta name="author" content="AI Wiki Team">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.2.0">
    
    
      
        <title>Splay - AI Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.750b69bd.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,400,400i,700|Fira+Mono">
        <style>body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../../manifest.webmanifest">
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ah@1.5.0/han.min.css">
    
      <link rel="stylesheet" href="../../_static/css/extra.css?v=11">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://hai5g.cn/aiwiki" title="AI Wiki" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              AI Wiki
            </span>
            <span class="md-header-nav__topic">
              Splay
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/myourdream/aiwiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aiwiki
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="简介" class="md-tabs__link">
          简介
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Coursera_ML_AndrewNg/" title="机器学习" class="md-tabs__link">
          机器学习
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../qa500/" title="深度学习500问" class="md-tabs__link">
          深度学习500问
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../lihang/" title="统计学习" class="md-tabs__link">
          统计学习
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../hands-on-ml-zh/README.old/" title="Sklearn与TensorFlow" class="md-tabs__link">
          Sklearn与TensorFlow
        </a>
      
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://hai5g.cn/aiwiki" title="AI Wiki" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    AI Wiki
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/myourdream/aiwiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aiwiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      简介
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        简介
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/AI学习路线/" title="AI学习路线1" class="md-nav__link">
      AI学习路线1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/ai-roadmap/ai-union-201904/" title="AI学习路线2" class="md-nav__link">
      AI学习路线2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/ai-roadmap/v0.1/" title="AI 路线图v0.1" class="md-nav__link">
      AI 路线图v0.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/ai-roadmap/v0.2/" title="AI 路线图v0.2" class="md-nav__link">
      AI 路线图v0.2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/ai-roadmap/v1.0/" title="ApacheCN 人工智能知识树" class="md-nav__link">
      ApacheCN 人工智能知识树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-7" type="checkbox" id="nav-1-7">
    
    <label class="md-nav__link" for="nav-1-7">
      工具软件
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-7">
        工具软件
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/judgers/" title="评测工具" class="md-nav__link">
      评测工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/editors/" title="编辑工具" class="md-nav__link">
      编辑工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/wsl/" title="WSL (Windows 10)" class="md-nav__link">
      WSL (Windows 10)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/spj/" title="Special Judge" class="md-nav__link">
      Special Judge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-7-5" type="checkbox" id="nav-1-7-5">
    
    <label class="md-nav__link" for="nav-1-7-5">
      Testlib
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-7-5">
        Testlib
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/testlib/" title="Testlib 简介" class="md-nav__link">
      Testlib 简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/testlib/general/" title="通用" class="md-nav__link">
      通用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/testlib/generator/" title="Generator" class="md-nav__link">
      Generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/testlib/validator/" title="Validator" class="md-nav__link">
      Validator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/testlib/interactor/" title="Interactor" class="md-nav__link">
      Interactor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/testlib/checker/" title="Checker" class="md-nav__link">
      Checker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/docker-deploy/" title="Docker 部署" class="md-nav__link">
      Docker 部署
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/about/" title="关于本项目" class="md-nav__link">
      关于本项目
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/faq/" title="F.A.Q." class="md-nav__link">
      F.A.Q.
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      机器学习
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        机器学习
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/SUMMARY/" title="目录" class="md-nav__link">
      目录
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/math/" title="数学基础" class="md-nav__link">
      数学基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week1/" title="week1" class="md-nav__link">
      week1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week2/" title="week2" class="md-nav__link">
      week2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week3/" title="week3" class="md-nav__link">
      week3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week4/" title="week4" class="md-nav__link">
      week4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week5/" title="week5" class="md-nav__link">
      week5
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week6/" title="week6" class="md-nav__link">
      week6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week7/" title="week7" class="md-nav__link">
      week7
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week8/" title="week8" class="md-nav__link">
      week8
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week9/" title="week9" class="md-nav__link">
      week9
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Coursera_ML_AndrewNg/markdown/week10/" title="week10" class="md-nav__link">
      week10
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      深度学习500问
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        深度学习500问
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/content/" title="目录" class="md-nav__link">
      目录
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch01_math/ch01_math/" title="第一章_数学基础" class="md-nav__link">
      第一章_数学基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch02_机器学习基础/第二章_机器学习基础/" title="第二章_机器学习基础" class="md-nav__link">
      第二章_机器学习基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch03_深度学习基础/第三章_深度学习基础/" title="第三章_深度学习基础" class="md-nav__link">
      第三章_深度学习基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch04_经典网络/第四章_经典网络/" title="第四章_经典网络" class="md-nav__link">
      第四章_经典网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch05_卷积神经网络(CNN)/第五章 卷积神经网络（CNN）/" title="第五章 卷积神经网络（CNN）" class="md-nav__link">
      第五章 卷积神经网络（CNN）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch06_循环神经网络(RNN)/第六章_循环神经网络(RNN)/" title="第六章_循环神经网络(RNN)" class="md-nav__link">
      第六章_循环神经网络(RNN)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch07_生成对抗网络(GAN)/ch7/" title="第七章_生成对抗网络(GAN)" class="md-nav__link">
      第七章_生成对抗网络(GAN)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch08_目标检测/第八章_目标检测/" title="第八章_目标检测" class="md-nav__link">
      第八章_目标检测
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch09_图像分割/第九章_图像分割/" title="第九章_图像分割" class="md-nav__link">
      第九章_图像分割
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch10_强化学习/第十章_强化学习/" title="第十章_强化学习" class="md-nav__link">
      第十章_强化学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch11_迁移学习/第十一章_迁移学习/" title="第十一章_迁移学习" class="md-nav__link">
      第十一章_迁移学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch12_网络搭建及训练/第十二章_网络搭建及训练/" title="第十二章_网络搭建及训练" class="md-nav__link">
      第十二章_网络搭建及训练
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch13_优化算法/第十三章_优化算法/" title="第十三章_优化算法" class="md-nav__link">
      第十三章_优化算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch14_超参数调整/第十四章_超参数调整/" title="第十四章_超参数调整" class="md-nav__link">
      第十四章_超参数调整
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch15_GPU和框架选型/第十五章_异构运算、GPU及框架选型/" title="第十五章_异构运算、GPU及框架选型" class="md-nav__link">
      第十五章_异构运算、GPU及框架选型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch16_自然语言处理(NLP)/第十六章_NLP/" title="第十六章_NLP" class="md-nav__link">
      第十六章_NLP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch17_模型压缩、加速及移动端部署/第十七章_模型压缩、加速及移动端部署/" title="第十七章_模型压缩、加速及移动端部署" class="md-nav__link">
      第十七章_模型压缩、加速及移动端部署
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch18_后端架构选型、离线及实时计算/第十八章_后端架构选型、离线及实时计算/" title="第十八章_后端架构选型、离线及实时计算" class="md-nav__link">
      第十八章_后端架构选型、离线及实时计算
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../qa500/ch18_后端架构选型及应用场景/第十八章_后端架构选型及应用场景/" title="第十八章_后端架构选型及应用场景" class="md-nav__link">
      第十八章_后端架构选型及应用场景
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      统计学习
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        统计学习
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH01/" title="统计学习及监督学习概论" class="md-nav__link">
      统计学习及监督学习概论
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH02/" title="感知机" class="md-nav__link">
      感知机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH03/" title="K近邻法" class="md-nav__link">
      K近邻法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH04/" title="朴素贝叶斯法" class="md-nav__link">
      朴素贝叶斯法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH05/" title="决策树" class="md-nav__link">
      决策树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH06/" title="逻辑斯蒂回归与最大熵模型" class="md-nav__link">
      逻辑斯蒂回归与最大熵模型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH07/" title="支持向量机" class="md-nav__link">
      支持向量机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH08/" title="提升方法" class="md-nav__link">
      提升方法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH09/" title="EM算法及其推广" class="md-nav__link">
      EM算法及其推广
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH10/" title="隐马尔可夫模型" class="md-nav__link">
      隐马尔可夫模型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH11/" title="条件随机场" class="md-nav__link">
      条件随机场
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH12/" title="监督学习方法总结" class="md-nav__link">
      监督学习方法总结
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH13/" title="无监督学习概论" class="md-nav__link">
      无监督学习概论
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH14/" title="聚类方法" class="md-nav__link">
      聚类方法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lihang/CH22/" title="无监督学习方法总结" class="md-nav__link">
      无监督学习方法总结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Sklearn与TensorFlow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Sklearn与TensorFlow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/README.old/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/0.前言/" title="前言" class="md-nav__link">
      前言
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/1.机器学习概览/" title="机器学习概览" class="md-nav__link">
      机器学习概览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/2.一个完整的机器学习项目/" title="一个完整的机器学习项目" class="md-nav__link">
      一个完整的机器学习项目
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/3.分类/" title="分类" class="md-nav__link">
      分类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/4.训练模型/" title="训练模型" class="md-nav__link">
      训练模型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/5.支持向量机/" title="支持向量机" class="md-nav__link">
      支持向量机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/6.决策树/" title="决策树" class="md-nav__link">
      决策树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/7.集成学习和随机森林/" title="集成学习和随机森林" class="md-nav__link">
      集成学习和随机森林
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/9.启动并运行_TensorFlow/" title="启动并运行_TensorFlow" class="md-nav__link">
      启动并运行_TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/10.人工神经网络介绍/" title="人工神经网络介绍" class="md-nav__link">
      人工神经网络介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/11.训练深层神经网络/" title="训练深层神经网络" class="md-nav__link">
      训练深层神经网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/12.设备和服务器上的分布式_TensorFlow/" title="设备和服务器上的分布式_TensorFlow" class="md-nav__link">
      设备和服务器上的分布式_TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/13.卷积神经网络/" title="卷积神经网络" class="md-nav__link">
      卷积神经网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/14.循环神经网络/" title="循环神经网络" class="md-nav__link">
      循环神经网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/15.自编码器/" title="自编码器" class="md-nav__link">
      自编码器
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/16.强化学习/" title="强化学习" class="md-nav__link">
      强化学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/B.机器学习项目清单/" title="机器学习项目清单" class="md-nav__link">
      机器学习项目清单
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/C.SVM_对偶问题/" title="SVM_对偶问题" class="md-nav__link">
      SVM_对偶问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hands-on-ml-zh/docs/D.自动微分/" title="自动微分" class="md-nav__link">
      自动微分
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="关于" class="md-nav__link">
      关于
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="简介" class="md-nav__link">
    简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="结构" class="md-nav__link">
    结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" title="二叉查找树的性质" class="md-nav__link">
    二叉查找树的性质
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="节点维护信息" class="md-nav__link">
    节点维护信息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="操作" class="md-nav__link">
    操作
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="基本操作" class="md-nav__link">
    基本操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="旋转操作" class="md-nav__link">
    旋转操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splay" title="Splay 操作" class="md-nav__link">
    Splay 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="插入操作" class="md-nav__link">
    插入操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x" title="查询 x 的排名" class="md-nav__link">
    查询 x 的排名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x_1" title="查询排名 x 的数" class="md-nav__link">
    查询排名 x 的数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="查询前驱" class="md-nav__link">
    查询前驱
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="查询后继" class="md-nav__link">
    查询后继
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="删除操作" class="md-nav__link">
    删除操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" title="完整代码" class="md-nav__link">
    完整代码
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" title="例题" class="md-nav__link">
    例题
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" title="练习题" class="md-nav__link">
    练习题
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="评论" class="md-nav__link md-nav__link--active">
            评论
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/myourdream/aiwiki/blob/master/docs/ds/splay.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Splay</h1>
                
                <blockquote>
<p>如何用 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 维护二叉查找树。</p>
</blockquote>
<hr />
<h2 id="_1">简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p><span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 是一种二叉查找树，它通过不断将某个节点旋转到根节点，使得整棵树仍然满足二叉查找树的性质，并且保持平衡而不至于退化为链，它由 Daniel Sleator 和 Robert Tarjan 发明。</p>
<hr />
<h2 id="_2">结构<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="_3">二叉查找树的性质<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>首先肯定是一棵二叉树！</p>
<p>能够在这棵树上查找某个值的性质：左儿子的值 <span><span class="MathJax_Preview">&lt;</span><script type="math/tex"><</script></span> 根节点的值 <span><span class="MathJax_Preview">&lt;</span><script type="math/tex"><</script></span> 右儿子的值。</p>
<h3 id="_4">节点维护信息<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th align="left"><span><span class="MathJax_Preview">rt</span><script type="math/tex">rt</script></span></th>
<th align="left"><span><span class="MathJax_Preview">tot</span><script type="math/tex">tot</script></span></th>
<th align="left"><span><span class="MathJax_Preview">fa[i]</span><script type="math/tex">fa[i]</script></span></th>
<th align="left"><span><span class="MathJax_Preview">ch[i][0/1]</span><script type="math/tex">ch[i][0/1]</script></span></th>
<th align="left"><span><span class="MathJax_Preview">val[i]</span><script type="math/tex">val[i]</script></span></th>
<th align="left"><span><span class="MathJax_Preview">cnt[i]</span><script type="math/tex">cnt[i]</script></span></th>
<th align="left"><span><span class="MathJax_Preview">sz[i]</span><script type="math/tex">sz[i]</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">根节点编号</td>
<td align="left">节点个数</td>
<td align="left">父亲</td>
<td align="left">左右儿子编号</td>
<td align="left">节点权值</td>
<td align="left">权值出现次数</td>
<td align="left">子树大小</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="_5">操作<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="_6">基本操作<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<ul>
<li><span><span class="MathJax_Preview">\text{maintain}(x)</span><script type="math/tex">\text{maintain}(x)</script></span> ：在改变节点位置后，将节点 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的 <span><span class="MathJax_Preview">\text{size}</span><script type="math/tex">\text{size}</script></span> 更新。</li>
<li><span><span class="MathJax_Preview">\text{get}(x)</span><script type="math/tex">\text{get}(x)</script></span> ：判断节点 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 是父亲节点的左儿子还是右儿子。</li>
<li><span><span class="MathJax_Preview">\text{clear}(x)</span><script type="math/tex">\text{clear}(x)</script></span> ：销毁节点 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 。</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">maintain</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">sz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">cnt</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> <span class="p">}</span>
<span class="kt">bool</span> <span class="nf">get</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">ch</span><span class="p">[</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="mi">1</span><span class="p">];</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">clear</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">sz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_7">旋转操作<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>为了使 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 保持平衡而进行旋转操作，旋转的本质是将某个节点上移一个位置。</p>
<p><strong>旋转需要保证</strong> ：</p>
<ul>
<li>整棵 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 的中序遍历不变（不能破坏二叉查找树的性质）。</li>
<li>受影响的节点维护的信息依然正确有效。</li>
<li><span><span class="MathJax_Preview">\text{root}</span><script type="math/tex">\text{root}</script></span> 必须指向旋转后的根节点。</li>
</ul>
<p>在 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 中旋转分为两种：左旋和右旋。</p>
<p><img alt="" src="../images/splay2.png" /></p>
<p><strong>具体分析旋转步骤</strong> （假设需要旋转的节点为 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> ，其父亲为 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> ，以右旋为例）</p>
<ol>
<li>将 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 的左儿子指向 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右儿子，且 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右儿子的父亲指向 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 。 <code>ch[y][0]=ch[x][1]; fa[ch[x][1]]=y;</code> </li>
<li>将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右儿子指向 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> ，且 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 的父亲指向 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 。 <code>ch[x][chk^1]=y; fa[y]=x;</code> </li>
<li>如果原来的 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 还有父亲 <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span> ，那么把 <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span> 的某个儿子（原来 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 所在的儿子位置）指向 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> ，且 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的父亲指向 <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span> 。 <code>fa[x]=z; if(z) ch[z][y==ch[z][1]]=x;</code> </li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">rotate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">z</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">chk</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">chk</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span> <span class="o">^</span> <span class="mi">1</span><span class="p">];</span>
  <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
  <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
  <span class="n">fa</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
  <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">ch</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="n">ch</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
  <span class="n">maintain</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="splay">Splay 操作<a class="headerlink" href="#splay" title="Permanent link">&para;</a></h3>
<p><span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 规定：每访问一个节点后都要强制将其旋转到根节点。此时旋转操作具体分为 <span><span class="MathJax_Preview">6</span><script type="math/tex">6</script></span> 种情况讨论（其中 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 为需要旋转到根的节点）</p>
<p><img alt="" src="../images/splay1.png" /></p>
<ul>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的父亲是根节点，直接将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 左旋或右旋（图 <span><span class="MathJax_Preview">1,2</span><script type="math/tex">1,2</script></span> ）。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的父亲不是根节点，且 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 和父亲的儿子类型相同，首先将其父亲左旋或右旋，然后将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 右旋或左旋（图 <span><span class="MathJax_Preview">3,4</span><script type="math/tex">3,4</script></span> ）。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的父亲不是根节点，且 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 和父亲的儿子类型不同，将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 左旋再右旋、或者右旋再左旋（图 <span><span class="MathJax_Preview">5,6</span><script type="math/tex">5,6</script></span> ）。</li>
</ul>
<p>分析起来一大串，其实代码一小段。大家可以自己模拟一下 <span><span class="MathJax_Preview">6</span><script type="math/tex">6</script></span> 种旋转情况，就能理解 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 的基本思想了。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">splay</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">f</span><span class="p">;</span> <span class="n">rotate</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="n">f</span><span class="p">])</span> <span class="n">rotate</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">?</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">x</span><span class="p">);</span>
  <span class="n">rt</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_8">插入操作<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>插入操作是一个比较复杂的过程，具体步骤如下（插入的值为 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> ）：</p>
<ul>
<li>如果树空了则直接插入根并退出。</li>
<li>如果当前节点的权值等于 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 则增加当前节点的大小并更新节点和父亲的信息，将当前节点进行 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 操作。</li>
<li>否则按照二叉查找树的性质向下找，找到空节点就插入即可（当然别忘了 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 操作哦）。</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">ins</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rt</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">val</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
    <span class="n">cnt</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="n">rt</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="n">maintain</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
      <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
      <span class="n">splay</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cnr</span><span class="p">;</span>
    <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cnr</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">val</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
      <span class="n">cnt</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="n">fa</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
      <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">val</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
      <span class="n">maintain</span><span class="p">(</span><span class="n">tot</span><span class="p">);</span>
      <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
      <span class="n">splay</span><span class="p">(</span><span class="n">tot</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="x">查询 x 的排名<a class="headerlink" href="#x" title="Permanent link">&para;</a></h3>
<p>根据二叉查找树的定义和性质，显然可以按照以下步骤查询 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的排名：</p>
<ul>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 比当前节点的权值小，向其左子树查找。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 比当前节点的权值大，将答案加上左子树（ <span><span class="MathJax_Preview">size</span><script type="math/tex">size</script></span> ）和当前节点（ <span><span class="MathJax_Preview">cnt</span><script type="math/tex">cnt</script></span> ）的大小，向其右子树查找。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 与当前节点的权值相同，将答案加 <span><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span> 并返回。</li>
</ul>
<p>注意最后需要进行 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 操作。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">rk</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">])</span> <span class="p">{</span>
      <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">res</span> <span class="o">+=</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">res</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">res</span> <span class="o">+=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">];</span>
      <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="x_1">查询排名 x 的数<a class="headerlink" href="#x_1" title="Permanent link">&para;</a></h3>
<p>设 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 为剩余排名，具体步骤如下：</p>
<ul>
<li>如果左子树非空且剩余排名 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 不大于左子树的大小 <span><span class="MathJax_Preview">size</span><script type="math/tex">size</script></span> ，那么向左子树查找。</li>
<li>否则将 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 减去左子树的和根的大小。如果此时 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 的值小于等于 <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span> ，则返回根节点的权值，否则继续向右子树查找。</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">kth</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span> <span class="p">{</span>
      <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">k</span> <span class="o">-=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span> <span class="o">+</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">];</span>
      <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_9">查询前驱<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>前驱定义为小于 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的最大的数，那么查询前驱可以转化为：将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 插入（此时 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 已经在根的位置了），前驱即为 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的左子树中最右边的节点，最后将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 删除即可。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">pre</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
  <span class="k">return</span> <span class="n">cnr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_10">查询后继<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>后继定义为大于 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的最小的数，查询方法和前驱类似： <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右子树中最左边的节点。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">nxt</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">return</span> <span class="n">cnr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_11">删除操作<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>删除操作也是一个比较复杂的操作，具体步骤如下：</p>
<ul>
<li>首先将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 旋转到根的位置。</li>
<li>
<p>接下来分为多个情况考虑：</p>
</li>
<li>
<p>如果有不止一个 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> ，那么将 <span><span class="MathJax_Preview">cnt[x]</span><script type="math/tex">cnt[x]</script></span> 减 <span><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span> 并退出。</p>
</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 没有儿子节点，那么直接将当前节点 <span><span class="MathJax_Preview">\text{clear}</span><script type="math/tex">\text{clear}</script></span> 并退出。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 只有一个儿子，那么先将当前节点 <span><span class="MathJax_Preview">\text{clear}</span><script type="math/tex">\text{clear}</script></span> 再把唯一的儿子作为根节点。</li>
<li>否则将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的前驱旋转到根并作为根节点，将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右子树接到根节点的右子树上，最后要将根的信息更新。</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">del</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">rk</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cnt</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
    <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
    <span class="n">clear</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
    <span class="n">rt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
    <span class="n">rt</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">fa</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
    <span class="n">rt</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">fa</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pre</span><span class="p">(),</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
  <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
  <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
  <span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
  <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<hr />
<h2 id="_12">完整代码<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">100005</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">rt</span><span class="p">,</span> <span class="n">tot</span><span class="p">,</span> <span class="n">fa</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">ch</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">cnt</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">sz</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="k">struct</span> <span class="n">Splay</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="n">maintain</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">sz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">cnt</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">get</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">ch</span><span class="p">[</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="mi">1</span><span class="p">];</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="n">clear</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">sz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">rotate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">z</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">chk</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">chk</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span> <span class="o">^</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">fa</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">ch</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="n">ch</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">maintain</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">splay</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">f</span><span class="p">;</span> <span class="n">rotate</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="n">f</span><span class="p">])</span> <span class="n">rotate</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">?</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">x</span><span class="p">);</span>
    <span class="n">rt</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">ins</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rt</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">val</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
      <span class="n">cnt</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="n">rt</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
      <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">cnr</span><span class="p">;</span>
      <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cnr</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">val</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">fa</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
        <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">val</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">tot</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">tot</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">rk</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">])</span> <span class="p">{</span>
          <span class="n">splay</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
          <span class="k">return</span> <span class="n">res</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">];</span>
        <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">kth</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span> <span class="p">{</span>
        <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">k</span> <span class="o">-=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span> <span class="o">+</span> <span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">];</span>
        <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">pre</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">cnr</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">nxt</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">cnr</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">del</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rk</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cnt</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
      <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
      <span class="n">clear</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
      <span class="n">rt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
      <span class="n">rt</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
      <span class="n">fa</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
      <span class="n">rt</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
      <span class="n">fa</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pre</span><span class="p">(),</span> <span class="n">cnr</span> <span class="o">=</span> <span class="n">rt</span><span class="p">;</span>
    <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
    <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="n">tree</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span> <span class="n">n</span><span class="p">;</span> <span class="o">--</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
      <span class="n">tree</span><span class="p">.</span><span class="n">ins</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">tree</span><span class="p">.</span><span class="n">del</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tree</span><span class="p">.</span><span class="n">rk</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tree</span><span class="p">.</span><span class="n">kth</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
      <span class="n">tree</span><span class="p">.</span><span class="n">ins</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">tree</span><span class="p">.</span><span class="n">pre</span><span class="p">()]),</span> <span class="n">tree</span><span class="p">.</span><span class="n">del</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">tree</span><span class="p">.</span><span class="n">ins</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">tree</span><span class="p">.</span><span class="n">nxt</span><span class="p">()]),</span> <span class="n">tree</span><span class="p">.</span><span class="n">del</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<hr />
<h2 id="_13">例题<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<p>以下题目都是裸的 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 维护二叉查找树。<del>（直接套板子即可）</del></p>
<ul>
<li><a href="https://loj.ac/problem/104">【模板】普通平衡树</a></li>
<li><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=1588">[HNOI2002]营业额统计</a></li>
<li><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=1208">[HNOI2004]宠物收养所</a></li>
</ul>
<h2 id="_14">练习题<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p><a href="https://www.luogu.org/problemnew/show/P4402">luogu P4402 [Cerc2007]robotic sort 机械排序</a>/<a href="https://www.lydsy.com/JudgeOnline/problem.php?id=1552">bzoj 1552（权限题）</a></p>
<p><a href="https://loj.ac/problem/106">二逼平衡树（树套树）</a></p>
<p><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=2827">bzoj 2827 千山鸟飞绝</a></p>
<p><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=4923">bzoj 4923[Lydsy1706 月赛]K 小值查询</a></p>
<hr />
<blockquote>
<p>本文部分内容引用于<a href="https://algocode.net">algocode 算法博客</a>，特别鸣谢！</p>
</blockquote>
                
                  
                
              
              
                


  <h2 id="__comments">评论</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://hai5g.cn/aiwiki/ds/splay/";
      this.page.identifier =
        "/ds/splay/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//AI-Wiki.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 AI Wiki Team
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.39abc4af.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdn.jsdelivr.net/gh/ethantw/Han@3.3.0/dist/han.min.js"></script>
      
        <script src="../../_static/js/extra.js?v=10"></script>
      
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>